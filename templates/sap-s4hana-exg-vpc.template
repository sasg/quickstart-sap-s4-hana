{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Deploy SAP HANA + App Server Cluster (ASCS, PAS & DB instance) + Additional App Server (qs-1pfasf6t3)",
    "Metadata": {
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
                    "Label": {
                        "default": "Existing network infrastructure details"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "VPCID",
                        "PrivateSubnet1CIDR",
                        "PrivateSubnet2CIDR",
                        "PublicSubnet1CIDR",
                        "PublicSubnet2CIDR",
                        "PrivateSubnet1AID",
                        "ApplicationCIDR",
                        "PublicSubnet1ID"
                    ]
                },
                {
                    "Label": {
                        "default": "HANA Server and storage configuration"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "hanaHA",
                        "MyOSHANA",
                        "SLESBYOSRegCode",
                        "SAPHANAHostname",
                        "HANAHostnameSecondary",
                        "HANAInstanceType",
                        "HANAHostCount",
                        "SID",
                        "HANAMasterPass",
                        "Encryption",
                        "VolumeTypeHanaData",
                        "VolumeTypeHanaLog",
                        "KeyName",
                        "HANAInstallMedia",
                        "EnableLogging",
                        "CloudTrailS3Bucket"
                    ]
                },
                {
                    "Label": {
                        "default": "SAP S/4HANA ABAP Cluster setup and configuration"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "HostedZoneName",
                        "StandardInstall",
                        "MyOS",
                        "EFSSapmnt",
                        "SAPPASHostname",
                        "MyInstanceType",
                        "AutoRecoveryPAS",
                        "InstallSAP",
                        "InstallSAPVersion",
                        "SAPSchemaName",
                        "SAPSID",
                        "SAPInstanceNum",
                        "SIDadmUID",
                        "SAPTZ",
                        "SAPInstallMediaBucket",
                        "SAPInstallMediaKeyPrefix"
                    ]
                },
                {
                    "Label": {
                        "default": "SAP S/4HANA Additional App Server setup and configuration"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "InstallSAPAAS",
                        "SAPAASHostname",
                        "AASMyInstanceType",
                        "PrivateSubnetID",
                        "AutoRecoveryAAS"
                    ]
                },
                {
                    "Label": {
                        "default": "Optional configuration"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "InstallRDPInstance",
                        "RDPInstanceType"
                    ]
                },
                {
                    "Label": {
                        "default": "Advanced configuration (Do not modify unless directed by AWS Support)"
                    },
                    "Description": {
                        "default": ""
                    },
                    "Parameters": [
                        "QSS3BucketName",
                        "QSS3KeyPrefix"
                    ]
                }
            ],
            "ParameterLabels": {
                "AASMyInstanceType": {
                    "default": "SAP additional app server instance type"
                },
                "ApplicationCIDR": {
                    "default": "2nd Private Subnet ID"
                },
                "AutoRecoveryPAS": {
                    "default": "EC2 auto recovery"
                },
                "CloudTrailS3Bucket": {
                    "default": "S3 bucket for AWS CloudTrail & AWS Config logs"
                },
                "EFSSapmnt": {
                    "default": "Use EFS for /sapmnt"
                },
                "StandardInstall": {
                    "default": "ASCS, PAS, DB in one host (standard installation)"
                },
                "EFSFSName": {
                    "default": "Existing EFS fs name"
                },
                "EnableLogging": {
                    "default": "Enable AWS CloudTrail & AWS Config logs"
                },
                "Encryption": {
                    "default": "Enable encryption"
                },
                "HANAHostCount": {
                    "default": "SAP HANA host count"
                },
                "HANAInstallMedia": {
                    "default": "S3 bucket for HANA s/w."
                },
                "HANAInstanceType": {
                    "default": "SAP HANA server"
                },
                "HANAMasterPass": {
                    "default": "SAP HANA DB & S/4HANA ABAP password"
                },
                "HostedZoneName": {
                    "default": "R53 private hosted zone"
                },
                "InstallRDPInstance": {
                    "default": "Install RDP"
                },
                "InstallSAP": {
                    "default": "Install SAP software"
                },
                "InstallSAPVersion": {
                    "default": "SAP S/4HANA version"
                },
                "InstallSAPAAS": {
                    "default": "Install SAP additional app server"
                },
                "KeyName": {
                    "default": "SSH key pair"
                },
                "MyInstanceType": {
                    "default": "SAP primary app server"
                },
                "MyOS": {
                    "default": "O.S. version for SAP servers"
                },
                "hanaHA": {
                    "default": "Implement HANA for High Availability"
                },
                "MyOSHANA": {
                    "default": "O.S. version for SAP HANA servers"
                },
                "PrivateSubnetID": {
                    "default": "AAS Private Subnet ID"
                },
                "PrivateSubnet2CIDR": {
                    "default": "2nd Private Subnet CIDR"
                },
                "PrivateSubnet1CIDR": {
                    "default": "1st Private Subnet CIDR"
                },
                "PrivateSubnet1AID": {
                    "default": "1st Private Subnet ID"
                },
                "PublicSubnet1ID": {
                    "default": "1st Public Subnet ID"
                },
                "PublicSubnet2CIDR": {
                    "default": "2nd Public Subnet CIDR"
                },
                "PublicSubnet1CIDR": {
                    "default": "1st Public Subnet CIDR"
                },
                "QSS3BucketName": {
                    "default": "S3 bucket name for the Quick Start assets."
                },
                "QSS3KeyPrefix": {
                    "default": "S3 key prefix for the Quick Start assets"
                },
                "RDPInstanceType": {
                    "default": "RDP instance type"
                },
                "SAPPASHostname": {
                    "default": "SAP PAS server host name (i.e. sidpas00)"
                },
                "SAPAASHostname": {
                    "default": "SAP AAS server host name (i.e. sidapp00)"
                },
                "SAPHANAHostname": {
                    "default": "SAP HANA server host name (i.e. siddbmas)"
                },
                "HANAHostnameSecondary": {
                    "default": "SAP HANA server host name for Secondary node (i.e. siddbsec)"
                },
                "SAPInstallMediaBucket": {
                    "default": "S3 bucket for SAP s/w"
                },
                "SAPInstallMediaKeyPrefix": {
                    "default": "S3 Key Prefix for SAP s/w"
                },
                "SAPSchemaName": {
                    "default": "SAP database schema"
                },
                "SID": {
                    "default": "HANA database system ID"
                },
                "SAPSID": {
                    "default": "SAP system ID"
                },
                "SAPInstanceNum": {
                    "default": "SAP instance number"
                },
                "SIDadmUID": {
                    "default": "SIDadm user id"
                },
                "SAPTZ": {
                    "default": "SAP server timezone"
                },
                "SLESBYOSRegCode": {
                    "default": "Enter SUSE BYOS registration code"
                },
                "VolumeTypeHanaData": {
                    "default": "Choose storage volume type for SAP HANA data"
                },
                "VolumeTypeHanaLog": {
                    "default": "Choose storage volume type for SAP HANA log"
                },
                "VPCID": {
                    "default": "VPC ID"
                }
            }
        }
    },
    "Parameters": {
        "ApplicationCIDR": {
            "Description": "The existing private subnet #2 in your VPC where you want to deploy SAP App Server Cluster.",
            "Type": "AWS::EC2::Subnet::Id"
        },
        "AutoRecoveryAAS": {
            "Type": "String",
            "Description": "EC2 Automatic recovery feature",
            "Default": "Yes",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "AutoRecoveryPAS": {
            "Type": "String",
            "Description": "EC2 Automatic recovery feature",
            "Default": "Yes",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "AASMyInstanceType": {
            "AllowedValues": [
                "r4.4xlarge",
                "r4.2xlarge",
                "r4.xlarge",
                "r4.large",
                "r5.4xlarge",
                "r5.2xlarge",
                "r5.xlarge",
                "r5.large",
                "m4.4xlarge",
                "m4.2xlarge",
                "m4.xlarge",
                "m4.large",
                "m5.4xlarge",
                "m5.2xlarge",
                "m5.xlarge",
                "m5.large",
                "c4.4xlarge",
                "c4.2xlarge",
                "c4.xlarge",
                "c4.large",
                "c5.4xlarge",
                "c5.2xlarge",
                "c5.xlarge",
                "c5.large"
            ],
            "Default": "r5.xlarge",
            "Description": "Instance type for SAP AAS Servers.",
            "Type": "String"
        },
        "StandardInstall": {
            "Description": "ASCS, PAS and DB in one EC2 Instance (System ID <SID> for HANA DB and S/4HANA must be different).",
            "Default": "No",
            "Type": "String",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "CloudTrailS3Bucket": {
            "Description": "Name of Amazon S3 bucket where AWS CloudTrail Trail and AWS Config logs can be stored (e.g. mycloudtrail).",
            "Default": "",
            "Type": "String"
        },
        "EFSSapmnt": {
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "Default": "No",
            "Description": "Enable (Yes) or disable (No) EFS for /sapmnt.",
            "Type": "String"
        },
        "EnableLogging": {
            "Description": "Enable (Yes) or disable (No) logging with AWS CloudTrail and AWS Config",
            "Default": "No",
            "Type": "String",
            "AllowedValues": [
                "Yes",
                "No"
            ]
        },
        "Encryption": {
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "Default": "No",
            "Description": "Enable (Yes) or disable (No) encryption on EBS volumes.",
            "Type": "String"
        },
        "HANAHostCount": {
            "Default": "1",
            "Description": "Total number of SAP HANA nodes you want to deploy in the SAP HANA cluster.",
            "MaxValue": "5",
            "MinValue": "1",
            "Type": "Number"
        },
        "HANAInstallMedia": {
            "Default": "s3://   /",
            "Description": "Name of your S3 bucket for your SAP HANA s/w. The s/w will *not* download if the format is not correct (e.g., s3://mysapbucket/HANA-media/).",
            "Type": "String"
        },
        "HANAInstanceType": {
            "AllowedValues": [
                "r3.8xlarge",
                "r3.4xlarge",
                "r3.2xlarge",
                "r4.16xlarge",
                "r4.8xlarge",
                "r4.4xlarge",
                "r4.2xlarge",
                "r5.2xlarge",
                "r5.4xlarge",
                "r5.12xlarge",
                "r5.24xlarge",
                "r5.metal",
                "x1.16xlarge",
                "x1.32xlarge",
                "x1e.xlarge",
                "x1e.2xlarge",
                "x1e.4xlarge",
                "x1e.32xlarge",
                "u-6tb1.metal",
                "u-9tb1.metal",
                "u-12tb1.metal",
                "u-18tb1.metal",
                "u-24tb1.metal"
            ],
            "Default": "r5.4xlarge",
            "Description": "Instance type for SAP HANA host.",
            "Type": "String"
        },
        "HANAMasterPass": {
            "AllowedPattern": "^(?=.*?[a-z])(?=.*?[A-Z])(?=.*[0-9]).*",
            "ConstraintDescription": "This must be at least 8 characters, including uppercase, lowercase, and numeric values.",
            "Description": "SAP HANA DB and S/4HANA password to use during installations.",
            "MinLength": "8",
            "NoEcho": "true",
            "Type": "String"
        },
        "HostedZoneName": {
            "Description": "A *new* R53 private hosted zone will be created. Use a fully-qualified domain name e.g. mycompany.local",
            "Type": "String",
            "MinLength": "1",
            "MaxLength": "64",
            "AllowedPattern": "(?!-)[a-zA-Z0-9-.]*(?<!-)",
            "ConstraintDescription": "must be a valid fully-qualified domain name."
        },
        "InstallRDPInstance": {
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "Default": "No",
            "Description": "Install (Yes) or don't install (No) optional RDP instance.",
            "Type": "String"
        },
        "InstallSAP": {
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "Default": "Yes",
            "Description": "Install (Yes) or don't install (No) SAP App Server. When set to No, *only* AWS infrastructure is provisioned.",
            "Type": "String"
        },
        "InstallSAPVersion": {
            "Type": "String",
            "Description": "SAP S/4HANA version to install.",
            "Default": "S/4HANA-1809",
            "AllowedValues": [
                "S/4HANA-1809"
            ]
        },
        "InstallSAPAAS": {
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "Default": "No",
            "Description": "Install (Yes) or (No) don't install SAP Additional App Servers. When No, *only* the SAP ASCS, DB & PAS are installed.",
            "Type": "String"
        },
        "KeyName": {
            "Description": "Name of an existing Amazon EC2 key pair. All instances will launch with this key pair.",
            "Type": "AWS::EC2::KeyPair::KeyName"
        },
        "MyInstanceType": {
            "AllowedValues": [
                "r4.4xlarge",
                "r4.2xlarge",
                "r4.xlarge",
                "r4.large",
                "r5.4xlarge",
                "r5.2xlarge",
                "r5.xlarge",
                "r5.large",
                "m4.4xlarge",
                "m4.2xlarge",
                "m4.xlarge",
                "m4.large",
                "m5.4xlarge",
                "m5.2xlarge",
                "m5.xlarge",
                "m5.large",
                "c4.4xlarge",
                "c4.2xlarge",
                "c4.xlarge",
                "c4.large",
                "c5.4xlarge",
                "c5.2xlarge",
                "c5.xlarge",
                "c5.large"
            ],
            "Default": "r5.xlarge",
            "Description": "Instance type for SAP Servers.",
            "Type": "String"
        },
        "hanaHA": {
            "AllowedValues": [
                "Yes",
                "No"
            ],
            "Default": "No",
            "Description": "Implement (Yes) or don't implement (No) HANA High Availability.",
            "Type": "String"
        },
        "MyOS": {
            "AllowedValues": [
                "Red-Hat-Enterprise-Linux-7.5-For-SAP-HVM",
                "Red-Hat-Enterprise-Linux-7.4-For-SAP-HA-US-HVM",
                "Red-Hat-Enterprise-Linux-7.5-For-SAP-HA-US-HVM",
                "Red-Hat-Enterprise-Linux-7.6-For-SAP-HA-US-HVM",
                "SuSE-Linux-11-SP4-HVM",
                "SuSE-Linux-12-SP1-HVM",
                "SuSE-Linux-12-SP2-HVM",
                "SuSE-Linux-12-SP3-HVM",
                "SuSE-Linux-12-SP4-HVM",
                "SuSE-Linux-15-HVM",
                "SuSE-Linux-12-SP2-For-SAP-HVM",
                "SuSE-Linux-12-SP3-For-SAP-HVM",
                "SuSE-Linux-12-SP4-For-SAP-HVM",
                "SuSE-Linux-15-For-SAP-HVM",
                "SuSE-Linux-12-SP1-For-SAP-BYOS-HVM",
                "SuSE-Linux-12-SP2-For-SAP-BYOS-HVM",
                "SuSE-Linux-12-SP3-For-SAP-BYOS-HVM",
                "SuSE-Linux-12-SP4-For-SAP-BYOS-HVM",
                "SuSE-Linux-15-For-SAP-BYOS-HVM"
            ],
            "Default": "SuSE-Linux-12-SP4-For-SAP-HVM",
            "Description": "Operating system version for SAP servers.",
            "Type": "String"
        },
        "MyOSHANA": {
            "Type": "String",
            "Description": "Operating system version for HANA servers.",
            "Default": "SuSE-Linux-12-SP4-For-SAP-HVM",
            "AllowedValues": [
                "Red-Hat-Enterprise-Linux-7.5-For-SAP-HVM",
                "Red-Hat-Enterprise-Linux-7.4-For-SAP-HA-US-HVM",
                "Red-Hat-Enterprise-Linux-7.5-For-SAP-HA-US-HVM",
                "Red-Hat-Enterprise-Linux-7.6-For-SAP-HA-US-HVM",
                "SuSE-Linux-11-SP4-HVM",
                "SuSE-Linux-12-SP1-HVM",
                "SuSE-Linux-12-SP3-HVM",
                "SuSE-Linux-12-SP4-HVM",
                "SuSE-Linux-15-HVM",
                "SuSE-Linux-12-SP2-For-SAP-HVM",
                "SuSE-Linux-12-SP3-For-SAP-HVM",
                "SuSE-Linux-12-SP4-For-SAP-HVM",
                "SuSE-Linux-15-For-SAP-HVM",
                "SuSE-Linux-12-SP1-For-SAP-BYOS-HVM",
                "SuSE-Linux-12-SP2-For-SAP-BYOS-HVM",
                "SuSE-Linux-12-SP3-For-SAP-BYOS-HVM",
                "SuSE-Linux-12-SP4-For-SAP-BYOS-HVM",
                "SuSE-Linux-15-For-SAP-BYOS-HVM"
            ]
        },
        "PrivateSubnetID": {
            "Description": "Private subnet to deploy SAP Additional App Server.",
            "Type": "AWS::EC2::Subnet::Id"
        },
        "PrivateSubnet1AID": {
            "Description": "The existing private subnet #1 in your VPC where you want to deploy SAP App Server Cluster.",
            "Type": "AWS::EC2::Subnet::Id"
        },
        "PrivateSubnet1CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$",
            "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28",
            "Default": "10.0.0.0/19",
            "Description": "CIDR block for private subnet 1 located in Availability Zone 1",
            "Type": "String"
        },
        "PrivateSubnet2CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$",
            "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28",
            "Default": "10.0.32.0/19",
            "Description": "CIDR block for private subnet 2 located in Availability Zone 2",
            "Type": "String"
        },
        "PublicSubnet1CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$",
            "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28",
            "Default": "10.0.128.0/20",
            "Description": "CIDR block for the public (DMZ) subnet 1 located in Availability Zone 1",
            "Type": "String"
        },
        "PublicSubnet1ID": {
            "Description": "The existing public subnet #1 in your VPC where your linux bastion and RDP are deployed.",
            "Type": "AWS::EC2::Subnet::Id"
        },
        "PublicSubnet2CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(1[6-9]|2[0-8]))$",
            "ConstraintDescription": "CIDR block parameter must be in the form x.x.x.x/16-28",
            "Default": "10.0.144.0/20",
            "Description": "CIDR block for the public (DMZ) subnet 2 located in Availability Zone 2",
            "Type": "String"
        },
        "QSS3BucketName": {
            "AllowedPattern": "^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$",
            "ConstraintDescription": "Quick Start bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).",
            "Default": "aws-quickstart",
            "Description": "S3 bucket name for the Quick Start assets. This string can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).",
            "Type": "String"
        },
        "QSS3KeyPrefix": {
            "AllowedPattern": "^[0-9a-zA-Z-/]*$",
            "ConstraintDescription": "Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).",
            "Default": "quickstart-sap-s4-hana/",
            "Description": "S3 key name prefix used to simulate a folder for your copy of the Quick Start assets. This prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slashes (/).",
            "Type": "String"
        },
        "RDPInstanceType": {
            "AllowedValues": [
                "c4.large",
                "c4.xlarge",
                "m4.large",
                "m4.xlarge"
            ],
            "Default": "c4.large",
            "Description": "Instance type for Windows RDP instance.",
            "Type": "String"
        },
        "SAPAASHostname": {
            "Default": "sidapp00",
            "Description": "Host name to use for SAP AAS Server.",
            "Type": "String"
        },
        "SAPHANAHostname": {
            "Default": "siddbmas",
            "Description": "Host name to use for SAP HANA database (SAP App server must be able to access HANA server).",
            "Type": "String"
        },
        "HANAHostnameSecondary": {
            "Default": "siddbsec",
            "Description": "Host name to use for SAP HANA Secondary DB server node.",
            "Type": "String"
        },
        "SAPInstallMediaBucket": {
            "Default": "my-sw-bucket",
            "Description": "Name of your S3 bucket for your SAP NetWeaver s/w. Do *NOT* include s3:// (use just your bucket name)",
            "Type": "String"
        },
        "SAPInstallMediaKeyPrefix": {
            "Default": "my/sw/version/",
            "Description": "Name of your S3 Key Prefix for your SAP NetWeaver s/w. Leave blank if you do not use a Key Prefix",
            "Type": "String"
        },
        "SAPInstanceNum": {
            "AllowedPattern": "([0-8]{1}[0-9]{1}|[9]{1}[0-7]{1})",
            "Default": "00",
            "Description": "SAP instance number to use for installation and setup, and to open ports for security groups.",
            "Type": "String"
        },
        "SAPPASHostname": {
            "Default": "sidpas00",
            "Description": "Host name to use for SAP PAS Server (DNS short name).",
            "Type": "String"
        },
        "SAPTZ": {
            "AllowedValues": [
                "PT",
                "CT",
                "ET",
                "UC"
            ],
            "ConstraintDescription": "This value must consist of 2 characters.",
            "Default": "UC",
            "Description": "The TimeZone of your SAP Server (PT, CT, ET, or UTC)",
            "Type": "String"
        },
        "SAPSchemaName": {
            "Default": "SAPHANADB",
            "Description": "SAP ABAP Schema name for HANA database.",
            "Type": "String"
        },
        "SID": {
            "AllowedPattern": "([A-Z]{1}[0-9A-Z]{2})",
            "ConstraintDescription": "This value must consist of 3 characters.",
            "Default": "HDB",
            "Description": "HANA DB system ID for installation and setup.",
            "Type": "String"
        },
        "SAPSID": {
            "AllowedPattern": "([A-Z]{1}[0-9A-Z]{2})",
            "ConstraintDescription": "This value must consist of 3 characters.",
            "Default": "S4H",
            "Description": "S/4HANA ABAP system ID for installation and setup (Must be different than the DB SID for Standard installation).",
            "Type": "String"
        },
        "SIDadmUID": {
            "Default": "1002",
            "Description": "UID (default is 1002) for the SIDadm user.",
            "Type": "String"
        },
        "SLESBYOSRegCode": {
            "Type": "String",
            "Default": "",
            "Description": "Registration code for SUSE BYOS (Applicable only if you use BYOS Option)."
        },
        "VolumeTypeHanaData": {
            "Type": "String",
            "Description": "EBS volume type for SAP HANA Data: General Purpose SSD (gp2) or Provisioned IOPS SSD (io1).",
            "Default": "gp2",
            "AllowedValues": [
                "gp2",
                "io1"
            ]
        },
        "VolumeTypeHanaLog": {
            "Type": "String",
            "Description": "EBS volume type for SAP HANA Log: General Purpose SSD (gp2) or Provisioned IOPS SSD (io1).",
            "Default": "gp2",
            "AllowedValues": [
                "gp2",
                "io1"
            ]
        },
        "VPCID": {
            "Description": "The existing Amazon VPC where you want to deploy SAP App Server Cluster.",
            "Type": "AWS::EC2::VPC::Id"
        }
    },
    "Conditions": {
        "AutoRecoveryMaster": {
            "Fn::Equals": [
                {
                    "Ref": "AutoRecoveryPAS"
                },
                "Yes"
            ]
        },
        "UseEFS": {
            "Fn::Equals": [
                {
                    "Ref": "EFSSapmnt"
                },
                "Yes"
            ]
        },
        "UseEFSNoHA": {
            "Fn::And": [
                {
                    "Condition": "UseEFS"
                },
                {
                    "Condition": "NoHA"
                }
            ]
        },
        "NoUseEFS": {
            "Fn::Equals": [
                {
                    "Ref": "EFSSapmnt"
                },
                "No"
            ]
        },
        "InstallRDP": {
            "Fn::Equals": [
                {
                    "Ref": "InstallRDPInstance"
                },
                "Yes"
            ]
        },
        "InstallSAPAASCond": {
            "Fn::Equals": [
                {
                    "Ref": "InstallSAPAAS"
                },
                "Yes"
            ]
        },
        "UseStandard": {
            "Fn::Equals": [
                {
                    "Ref": "StandardInstall"
                },
                "Yes"
            ]
        },
        "NoUseStandard": {
            "Fn::Equals": [
                {
                    "Ref": "StandardInstall"
                },
                "No"
            ]
        },
        "UseHA": {
            "Fn::Equals": [
                {
                    "Ref": "hanaHA"
                },
                "Yes"
            ]
        },
        "NoHA": {
            "Fn::Equals": [
                {
                    "Ref": "hanaHA"
                },
                "No"
            ]
        },
        "NoUseStandardNoHA": {
            "Fn::And": [
                {
                    "Condition": "NoUseStandard"
                },
                {
                    "Condition": "NoHA"
                }
            ]
        },
        "NoUseStandardNoUseEFS": {
            "Fn::And": [
                {
                    "Condition": "NoUseStandard"
                },
                {
                    "Condition": "NoHA"
                },
                {
                    "Condition": "NoUseEFS"
                }
            ]
        },
        "NoUseStandardNoUseEFSAAS": {
            "Fn::And": [
                {
                    "Condition": "NoUseStandard"
                },
                {
                    "Condition": "NoUseEFS"
                },
                {
                    "Condition": "NoHA"
                },
                {
                    "Condition": "InstallSAPAASCond"
                }
            ]
        },
        "NoUseStandardUseEFS": {
            "Fn::And": [
                {
                    "Condition": "NoUseStandard"
                },
                {
                    "Condition": "NoHA"
                },
                {
                    "Condition": "UseEFS"
                }
            ]
        },
        "NoUseStandardUseEFSAAS": {
            "Fn::And": [
                {
                    "Condition": "NoUseStandard"
                },
                {
                    "Condition": "UseEFS"
                },
                {
                    "Condition": "NoHA"
                },
                {
                    "Condition": "InstallSAPAASCond"
                }
            ]
        }
    },
    "Mappings": {
        "SAPHANAOSNameMap": {
            "Red-Hat-Enterprise-Linux-7.5-For-SAP-HVM": {
                "Code": "RedHatLinux75ForSAP"
            },
            "Red-Hat-Enterprise-Linux-7.4-For-SAP-HA-US-HVM": {
                "Code": "RedHatLinux74ForSAP-With-HA-US"
            },
            "Red-Hat-Enterprise-Linux-7.5-For-SAP-HA-US-HVM": {
                "Code": "RedHatLinux75ForSAP-With-HA-US"
            },
            "Red-Hat-Enterprise-Linux-7.6-For-SAP-HA-US-HVM": {
                "Code": "RedHatLinux76ForSAP-With-HA-US"
            },
            "SuSE-Linux-11-SP4-HVM": {
                "Code": "SuSELinux11SP4"
            },
            "SuSE-Linux-12-SP1-HVM": {
                "Code": "SuSELinux12SP1"
            },
            "SuSE-Linux-12-SP2-HVM": {
                "Code": "SuSELinux12SP2"
            },
            "SuSE-Linux-12-SP3-HVM": {
                "Code": "SuSELinux12SP3"
            },
            "SuSE-Linux-12-SP4-HVM": {
                "Code": "SuSELinux12SP4"
            },
            "SuSE-Linux-15-HVM": {
                "Code": "SuSELinux15"
            },
            "SuSE-Linux-12-SP2-For-SAP-HVM": {
                "Code": "SuSELinux12SP2ForSAP"
            },
            "SuSE-Linux-12-SP3-For-SAP-HVM": {
                "Code": "SuSELinux12SP3ForSAP"
            },
            "SuSE-Linux-12-SP4-For-SAP-HVM": {
                "Code": "SuSELinux12SP4ForSAP"
            },
            "SuSE-Linux-15-For-SAP-HVM": {
                "Code": "SuSELinux15ForSAP"
            },
            "SuSE-Linux-12-SP1-For-SAP-BYOS-HVM": {
                "Code": "SuSELinux12SP1ForSAP-BYOS"
            },
            "SuSE-Linux-12-SP2-For-SAP-BYOS-HVM": {
                "Code": "SuSELinux12SP2ForSAP-BYOS"
            },
            "SuSE-Linux-12-SP3-For-SAP-BYOS-HVM": {
                "Code": "SuSELinux12SP3ForSAP-BYOS"
            },
            "SuSE-Linux-12-SP4-For-SAP-BYOS-HVM": {
                "Code": "SuSELinux12SP4ForSAP-BYOS"
            },
            "SuSE-Linux-15-For-SAP-BYOS-HVM": {
                "Code": "SuSELinux15ForSAP-BYOS"
            }
        },
        "SAPAMINameMap": {
            "Red-Hat-Enterprise-Linux-7.5-For-SAP-HVM": {
                "Code": "RHEL75SAPHVM"
            },
            "Red-Hat-Enterprise-Linux-7.4-For-SAP-HA-US-HVM": {
                "Code": "RHEL74SAPHAUSHVM"
            },
            "Red-Hat-Enterprise-Linux-7.5-For-SAP-HA-US-HVM": {
                "Code": "RHEL75SAPHAUSHVM"
            },
            "Red-Hat-Enterprise-Linux-7.6-For-SAP-HA-US-HVM": {
                "Code": "RHEL76SAPHAUSHVM"
            },
            "SuSE-Linux-11-SP4-HVM": {
                "Code": "SLES11SP4HVM"
            },
            "SuSE-Linux-12-HVM": {
                "Code": "SLES12HVM"
            },
            "SuSE-Linux-12-SP1-HVM": {
                "Code": "SLES12SP1HVM"
            },
            "SuSE-Linux-12-SP2-HVM": {
                "Code": "SLES12SP2HVM"
            },
            "SuSE-Linux-12-SP3-HVM": {
                "Code": "SLES12SP3HVM"
            },
            "SuSE-Linux-12-SP4-HVM": {
                "Code": "SLES12SP4HVM"
            },
            "SuSE-Linux-15-HVM": {
                "Code": "SLES15HVM"
            },
            "SuSE-Linux-12-SP2-For-SAP-HVM": {
                "Code": "SLES12SP2SAPHVM"
            },
            "SuSE-Linux-12-SP3-For-SAP-HVM": {
                "Code": "SLES12SP3SAPHVM"
            },
            "SuSE-Linux-12-SP4-For-SAP-HVM": {
                "Code": "SLES12SP4SAPHVM"
            },
            "SuSE-Linux-15-For-SAP-HVM": {
                "Code": "SLES15SAPHVM"
            },
            "SuSE-Linux-12-SP1-For-SAP-BYOS-HVM": {
                "Code": "SLES12SP1SAPBYOSHVM"
            },
            "SuSE-Linux-12-SP2-For-SAP-BYOS-HVM": {
                "Code": "SLES12SP2SAPBYOSHVM"
            },
            "SuSE-Linux-12-SP3-For-SAP-BYOS-HVM": {
                "Code": "SLES12SP3SAPBYOSHVM"
            },
            "SuSE-Linux-12-SP4-For-SAP-BYOS-HVM": {
                "Code": "SLES12SP4SAPBYOSHVM"
            },
            "SuSE-Linux-15-For-SAP-BYOS-HVM": {
                "Code": "SLES15SAPBYOSHVM"
            }
        },
        "AWSAMIRegionMap": {
            "AMI": {
                "RHEL75SAPHVM": "SAP-7.5_HVM_GA-20180911-x86_64-0-Hourly2-GP2-b676039c-a4f8-4be7-9866-c804b1ade684-ami-01e5a531ae8d3d976.4",
                "RHEL74SAPHAUSHVM": "SAPHAE4S-7.4_HVM-20181108-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-ami-0c3e857ffeab71ac5.4",
                "RHEL75SAPHAUSHVM": "SAPHAEUS-7.5_HVM-20181108-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-ami-081c0b27c08752050.4",
                "RHEL76SAPHAUSHVM": "SAP-7.6_E4S_HA_US_HVM-20190221-x86_64-2-Hourly2-GP2-5cca0aac-b678-4e46-80e2-344cfed26a62-ami-0e49c67162a6956e9.4",
                "SLES11SP4HVM": "suse-sles-11-sp4-v20180816-hvm-ssd-x86_64",
                "SLES12SP1HVM": "suse-sles-12-sp1-v20161021-hvm-ssd-x86_64",
                "SLES12SP2HVM": "suse-sles-12-sp2-v20170620-hvm-ssd-x86_64",
                "SLES12SP3HVM": "suse-sles-12-sp3-v20181004-hvm-ssd-x86_64",
                "SLES12SP4HVM": "suse-sles-12-sp4-v20190314-hvm-ssd-x86_64",
                "SLES15HVM": "suse-sles-15-v20180806-hvm-ssd-x86_64",
                "SLES12SP2SAPHVM": "suse-sles-sap-12-sp2-v20180706-hvm-ssd-x86_64-e3458d64-5c36-4577-bd98-0ee19e3eaeec-ami-3ac5ea45.4",
                "SLES12SP3SAPHVM": "suse-sles-sap-12-sp3-v20180814-hvm-ssd-x86_64-da7aa9c3-97db-4573-89a6-7fe7348d90b0-ami-0df5b06332b816a8e.4",
                "SLES12SP4SAPHVM": "suse-sles-sap-12-sp4-v20181212-hvm-ssd-x86_64-8f7bb679-fb90-4446-aa80-9b6cfd834710-ami-015bf44384c484ccb.4",
                "SLES15SAPHVM": "suse-sles-sap-15-v20180806-hvm-ssd-x86_64-6a4bc5af-a084-4f96-8402-5cd249e9091d-ami-06aee2e6db735d4f4.4",
                "SLES12SP1SAPBYOSHVM": "suse-sles-sap-12-sp1-byos-v20170123-hvm-ssd-x86_64",
                "SLES12SP2SAPBYOSHVM": "suse-sles-sap-12-sp2-byos-v20180816-hvm-ssd-x86_64",
                "SLES12SP3SAPBYOSHVM": "suse-sles-sap-12-sp3-byos-v20180814-hvm-ssd-x86_64",
                "SLES12SP4SAPBYOSHVM": "suse-sles-sap-12-sp4-byos-v20190314-hvm-ssd-x86_64",
                "SLES15SAPBYOSHVM": "suse-sles-sap-15-byos-v20180816-hvm-ssd-x86_64",
                "WS2012R2": "Windows_Server-2012-R2_RTM-English-64Bit-Base-2019.05.15"
            },
            "ap-northeast-1": {
                "RHEL75SAPHVM": "ami-0ce47f39a0a21f61e",
                "RHEL74SAPHAUSHVM": "ami-0033f0d7d626f014f",
                "RHEL75SAPHAUSHVM": "ami-08d13c2bb0c07e8e3",
                "RHEL76SAPHAUSHVM": "ami-092eb64b443171d7e",
                "SLES11SP4HVM": "ami-0c6f393bb8d20159a",
                "SLES12SP1HVM": "ami-d94fe9b8",
                "SLES12SP1SAPBYOSHVM": "ami-63473c04",
                "SLES12SP2HVM": "ami-a07560c7",
                "SLES12SP2SAPBYOSHVM": "ami-08284f006764f604d",
                "SLES12SP2SAPHVM": "ami-0dafd3cd1e6f7ab55",
                "SLES12SP3HVM": "ami-050f5170e43607893",
                "SLES12SP3SAPBYOSHVM": "ami-015b1feb4b30a3040",
                "SLES12SP3SAPHVM": "ami-0e2702a1d0201067e",
                "SLES12SP4HVM": "ami-0878f92c2d18d7474",
                "SLES12SP4SAPBYOSHVM": "ami-010835c76895df4af",
                "SLES12SP4SAPHVM": "ami-0880b2aee7a4236db",
                "SLES15HVM": "ami-056ac8ad44e6a7e1f",
                "SLES15SAPHVM": "ami-0174751ba72376df1",
                "SLES15SAPBYOSHVM": "ami-0792bb0aaa616f9c9",
                "WS2012R2": "ami-0fc17fdf7145490d4"
            },
            "ap-northeast-2": {
                "RHEL75SAPHVM": "ami-06db50be1842d6b9a",
                "RHEL74SAPHAUSHVM": "ami-0450ac5a5b079fa41",
                "RHEL75SAPHAUSHVM": "ami-0521b6ebbf151e58a",
                "RHEL76SAPHAUSHVM": "ami-04384779af6b49648",
                "SLES11SP4HVM": "ami-00e7068674ce94853",
                "SLES12SP1HVM": "ami-1ced3972",
                "SLES12SP1SAPBYOSHVM": "ami-b5f928db",
                "SLES12SP2HVM": "ami-86d00fe8",
                "SLES12SP2SAPBYOSHVM": "ami-0cb72d1d6fb9e6b4e",
                "SLES12SP2SAPHVM": "ami-01ac90a30afcb8662",
                "SLES12SP3HVM": "ami-00728f974fb4b3f2a",
                "SLES12SP3SAPBYOSHVM": "ami-07985cf93612b4a01",
                "SLES12SP3SAPHVM": "ami-0332cc351e9b34c56",
                "SLES12SP4HVM": "ami-002559f4034e04afe",
                "SLES12SP4SAPBYOSHVM": "ami-0784273b0798b2f4f",
                "SLES12SP4SAPHVM": "ami-0146dc4a108cc9614",
                "SLES15HVM": "ami-0f81fff879bafe6b8",
                "SLES15SAPHVM": "ami-025bc5b179c7689f8",
                "SLES15SAPBYOSHVM": "ami-0268aae2b7e421b07",
                "WS2012R2": "ami-0b556f49b82ce9aa4"
            },
            "ap-south-1": {
                "RHEL75SAPHVM": "ami-0afdd099cb4cacadf",
                "RHEL74SAPHAUSHVM": "ami-0167ffd4ebf2c034a",
                "RHEL75SAPHAUSHVM": "ami-029b2a9859384e194",
                "RHEL76SAPHAUSHVM": "ami-015afb3901ab40784",
                "SLES11SP4HVM": "ami-0bdb8670f707feabd",
                "SLES12SP1HVM": "ami-985226f7",
                "SLES12SP1SAPBYOSHVM": "ami-93c9bffc",
                "SLES12SP2HVM": "ami-62e39c0d",
                "SLES12SP2SAPBYOSHVM": "ami-0e70efddb6f14b5d3",
                "SLES12SP2SAPHVM": "ami-06b754d754ed8c43c",
                "SLES12SP3HVM": "ami-0c1453eb750c7a5ab",
                "SLES12SP3SAPBYOSHVM": "ami-038f5eec5240991fb",
                "SLES12SP3SAPHVM": "ami-0dbd17f897682979a",
                "SLES12SP4HVM": "ami-0db518a8b39b20e05",
                "SLES12SP4SAPBYOSHVM": "ami-003c54b69e4fa1de5",
                "SLES12SP4SAPHVM": "ami-0704c94f703b9e324",
                "SLES15HVM": "ami-01be89269d32f2a16",
                "SLES15SAPHVM": "ami-01a38e853e458e7e4",
                "SLES15SAPBYOSHVM": "ami-03e3f217995931db6",
                "WS2012R2": "ami-064338cb31cb626f9"
            },
            "ap-southeast-1": {
                "RHEL75SAPHVM": "ami-08fc0673d9d83037a",
                "RHEL74SAPHAUSHVM": "ami-037dc0ec600ed1888",
                "RHEL75SAPHAUSHVM": "ami-05c8713dd14fa6156",
                "RHEL76SAPHAUSHVM": "ami-0469d4463a41ed704",
                "SLES11SP4HVM": "ami-021e49892145e1949",
                "SLES12SP1HVM": "ami-163d9b75",
                "SLES12SP1SAPBYOSHVM": "ami-ab0aa0c8",
                "SLES12SP2HVM": "ami-f1078a92",
                "SLES12SP2SAPBYOSHVM": "ami-0518ff9866eadc68b",
                "SLES12SP2SAPHVM": "ami-00e6fba1cebcf3560",
                "SLES12SP3HVM": "ami-06190570cf455031a",
                "SLES12SP3SAPBYOSHVM": "ami-0c0801486ca809514",
                "SLES12SP3SAPHVM": "ami-0d75b5c8dd39d157d",
                "SLES12SP4HVM": "ami-0eeb8d6d88b0e651d",
                "SLES12SP4SAPBYOSHVM": "ami-036b074ebaf8a7a15",
                "SLES12SP4SAPHVM": "ami-0882cc7355a3ec5f9",
                "SLES15HVM": "ami-070356c21596ddc67",
                "SLES15SAPHVM": "ami-0b312f69647b63e0e",
                "SLES15SAPBYOSHVM": "ami-0fb42054cd76f9f53",
                "WS2012R2": "ami-0c7412dbeb3811092"
            },
            "ap-southeast-2": {
                "RHEL75SAPHVM": "ami-0a8af8e94f35319ba",
                "RHEL74SAPHAUSHVM": "ami-0c5b5357081c68218",
                "RHEL75SAPHAUSHVM": "ami-0df9dbd4828ca1166",
                "RHEL76SAPHAUSHVM": "ami-0356eb53cb824dc7e",
                "SLES11SP4HVM": "ami-0c966540b7cd84b4b",
                "SLES12SP1HVM": "ami-e32b1680",
                "SLES12SP1SAPBYOSHVM": "ami-460d0a25",
                "SLES12SP2HVM": "ami-197a6a7a",
                "SLES12SP2SAPBYOSHVM": "ami-0ab0b11afd04e6f03",
                "SLES12SP2SAPHVM": "ami-01163d2bc0933a2e7",
                "SLES12SP3HVM": "ami-0ccbc8eb74e84b8bd",
                "SLES12SP3SAPBYOSHVM": "ami-08d8d62d140df5f26",
                "SLES12SP3SAPHVM": "ami-0c355880aff41dd5b",
                "SLES12SP4HVM": "ami-057b1636ab22a9258",
                "SLES12SP4SAPBYOSHVM": "ami-0bbddbd10628600eb",
                "SLES12SP4SAPHVM": "ami-085f0e4b00a1fff98",
                "SLES15HVM": "ami-0c4245381c67efb39",
                "SLES15SAPHVM": "ami-0c995271948cbb736",
                "SLES15SAPBYOSHVM": "ami-056fe47614a9a42ae",
                "WS2012R2": "ami-08e9a6cc5e9ea17e9"
            },
            "ca-central-1": {
                "RHEL75SAPHVM": "ami-010ef109ec0f43d6d",
                "RHEL74SAPHAUSHVM": "ami-06e94c1c4cd754fe5",
                "RHEL75SAPHAUSHVM": "ami-0173442cbf82d3d9f",
                "RHEL76SAPHAUSHVM": "ami-0c720e8ded4a6c5b0",
                "SLES11SP4HVM": "ami-0a89186e8d2b82307",
                "SLES12SP1SAPBYOSHVM": "ami-2fd4694b",
                "SLES12SP2HVM": "ami-d5d56ab1",
                "SLES12SP2SAPBYOSHVM": "ami-0a2961e55928d327f",
                "SLES12SP2SAPHVM": "ami-0efcd8732b1309315",
                "SLES12SP3HVM": "ami-0f7c9a39e20a9adea",
                "SLES12SP3SAPBYOSHVM": "ami-01560bcdbe2e731d5",
                "SLES12SP3SAPHVM": "ami-0141f65ef9ecc2dde",
                "SLES12SP4HVM": "ami-09adcab1ad14acc87",
                "SLES12SP4SAPBYOSHVM": "ami-0dfe4c179514e202b",
                "SLES12SP4SAPHVM": "ami-0912552684a960126",
                "SLES15HVM": "ami-0c97d9b588207dad6",
                "SLES15SAPHVM": "ami-07d033739f020a039",
                "SLES15SAPBYOSHVM": "ami-06d886246b429061e",
                "WS2012R2": "ami-0cf495517ac09e901"
            },
            "eu-central-1": {
                "RHEL75SAPHVM": "ami-0841ec948df565271",
                "RHEL74SAPHAUSHVM": "ami-0a38565bcb3243da0",
                "RHEL75SAPHAUSHVM": "ami-08f1018e2a0f26daa",
                "RHEL76SAPHAUSHVM": "ami-00e9db6661b279d3f",
                "SLES11SP4HVM": "ami-0f032693ef4319469",
                "SLES12SP1HVM": "ami-59699036",
                "SLES12SP1SAPBYOSHVM": "ami-4b6ba424",
                "SLES12SP2HVM": "ami-984ee9f7",
                "SLES12SP2SAPBYOSHVM": "ami-02df24b4c89e9e3e7",
                "SLES12SP2SAPHVM": "ami-06865b212989f946a",
                "SLES12SP3HVM": "ami-0fa9bde3f3d40e5ae",
                "SLES12SP3SAPBYOSHVM": "ami-028e45d17af35e5f5",
                "SLES12SP3SAPHVM": "ami-08be7ee93e3c17eeb",
                "SLES12SP4HVM": "ami-030c9846e1fc0f9fe",
                "SLES12SP4SAPBYOSHVM": "ami-0bd748f69a1b0f3f6",
                "SLES12SP4SAPHVM": "ami-06998d657605ecffc",
                "SLES15HVM": "ami-05dfd265ea534a3e9",
                "SLES15SAPHVM": "ami-0823a4f2cd6f5ff6c",
                "SLES15SAPBYOSHVM": "ami-0a514e2b7af1c84e5",
                "WS2012R2": "ami-0033b3ecc3bf13cd4"
            },
            "eu-west-1": {
                "RHEL75SAPHVM": "ami-04a014a7d626b3fd8",
                "RHEL74SAPHAUSHVM": "ami-0af3e97778546f34b",
                "RHEL75SAPHAUSHVM": "ami-0dfa47f27b3bf9922",
                "RHEL76SAPHAUSHVM": "ami-0e39a11a4694e879d",
                "SLES11SP4HVM": "ami-0a40ff0e3202c10e1",
                "SLES12SP1HVM": "ami-b197d9c2",
                "SLES12SP1SAPBYOSHVM": "ami-81025de7",
                "SLES12SP2HVM": "ami-f5776f93",
                "SLES12SP2SAPBYOSHVM": "ami-0b710f90881364c81",
                "SLES12SP2SAPHVM": "ami-0e25482b9d80278a8",
                "SLES12SP3HVM": "ami-06bc7889ee68f279e",
                "SLES12SP3SAPBYOSHVM": "ami-0deef8411e9567df2",
                "SLES12SP3SAPHVM": "ami-077fcc421d993a777",
                "SLES12SP4HVM": "ami-065b4eeb903b89038",
                "SLES12SP4SAPBYOSHVM": "ami-0cf4d8eabbea68cad",
                "SLES12SP4SAPHVM": "ami-07d5a83d70cf1e29b",
                "SLES15HVM": "ami-0a58a1b152ba55f1d",
                "SLES15SAPHVM": "ami-0fda5e832418d2123",
                "SLES15SAPBYOSHVM": "ami-0d001a8c828e1ec55",
                "WS2012R2": "ami-0d0ebc27444cd1f93"
            },
            "eu-west-2": {
                "RHEL75SAPHVM": "ami-070b8ef548695f653",
                "RHEL74SAPHAUSHVM": "ami-005b4b0f0decc3229",
                "RHEL75SAPHAUSHVM": "ami-0d24c16fec55a94f4",
                "RHEL76SAPHAUSHVM": "ami-0aeabd574eb91aa0b",
                "SLES11SP4HVM": "ami-06a87787f9466fa7b",
                "SLES12SP1SAPBYOSHVM": "ami-b2a1abd6",
                "SLES12SP2HVM": "ami-d97066bd",
                "SLES12SP2SAPBYOSHVM": "ami-09d6d16849bddb5e0",
                "SLES12SP2SAPHVM": "ami-0ff1c44b6254be35f",
                "SLES12SP3HVM": "ami-0eb4bd78fba2f32e4",
                "SLES12SP3SAPBYOSHVM": "ami-0ed60b9c723f94a33",
                "SLES12SP3SAPHVM": "ami-0c201f1c455ac4823",
                "SLES12SP4HVM": "ami-02cb6d1ccf5327f24",
                "SLES12SP4SAPBYOSHVM": "ami-07194b14ca4764334",
                "SLES12SP4SAPHVM": "ami-08d276a6abd4bc4e5",
                "SLES15HVM": "ami-01497522185aaa4ee",
                "SLES15SAPHVM": "ami-060b2e1e236b73f00",
                "SLES15SAPBYOSHVM": "ami-03f2f32a0229f45dd",
                "WS2012R2": "ami-0463e294aadede163"
            },
            "eu-west-3": {
                "RHEL75SAPHVM": "ami-0b9d6c1ae0e94e8a9",
                "RHEL74SAPHAUSHVM": "ami-01f114d111cc45831",
                "RHEL75SAPHAUSHVM": "ami-0d0e00736cd23369b",
                "RHEL76SAPHAUSHVM": "ami-0c1cf4ecf66e353e8",
                "SLES11SP4HVM": "ami-036671c4b09355867",
                "SLES12SP1SAPBYOSHVM": "ami-cf992eb2",
                "SLES12SP2SAPBYOSHVM": "ami-07715d8785ab4be9a",
                "SLES12SP2SAPHVM": "ami-008bcc706b62df0fb",
                "SLES12SP3HVM": "ami-07b20332d54ed21e8",
                "SLES12SP3SAPBYOSHVM": "ami-0e241f56a1dac4696",
                "SLES12SP3SAPHVM": "ami-03c8cb58d31831671",
                "SLES12SP4HVM": "ami-0e6bd2a6c500d40ff",
                "SLES12SP4SAPBYOSHVM": "ami-08460c948336b270c",
                "SLES12SP4SAPHVM": "ami-0a40138656742f075",
                "SLES15HVM": "ami-0f238bd4c6fdbefb0",
                "SLES15SAPHVM": "ami-0a10a689c47a8a6af",
                "SLES15SAPBYOSHVM": "ami-0c7e819f30af46768",
                "WS2012R2": "ami-0094d544cbdebcb79"
            },
            "sa-east-1": {
                "RHEL75SAPHVM": "ami-0a9ee704defec0845",
                "RHEL74SAPHAUSHVM": "ami-04450cf66c6bf5f42",
                "RHEL75SAPHAUSHVM": "ami-0fb635cae4f8c6028",
                "RHEL76SAPHAUSHVM": "ami-0c60751a062c4295b",
                "SLES11SP4HVM": "ami-00134f83806a20f4a",
                "SLES12SP1HVM": "ami-ce3aa7a2",
                "SLES12SP1SAPBYOSHVM": "ami-eb543187",
                "SLES12SP2HVM": "ami-52a4cf3e",
                "SLES12SP2SAPBYOSHVM": "ami-0c7bf8beb8998329b",
                "SLES12SP2SAPHVM": "ami-05d575f869032b973",
                "SLES12SP3HVM": "ami-0188b2a9dc0ae5f44",
                "SLES12SP3SAPBYOSHVM": "ami-063007da56fe6ed90",
                "SLES12SP3SAPHVM": "ami-06d49460112eae218",
                "SLES12SP4HVM": "ami-0fd7b4d69dfcc72ee",
                "SLES12SP4SAPBYOSHVM": "ami-0b8234371cf7e94a9",
                "SLES12SP4SAPHVM": "ami-007f7ce65e71872dc",
                "SLES15HVM": "ami-0772af912976aa692",
                "SLES15SAPHVM": "ami-0867633aaf95b8b45",
                "SLES15SAPBYOSHVM": "ami-0ab56c32bb45cf598",
                "WS2012R2": "ami-03fff00bfd663db28"
            },
            "us-east-1": {
                "RHEL75SAPHVM": "ami-05cd8f1730c8df7dc",
                "RHEL74SAPHAUSHVM": "ami-0f458a41a777ef497",
                "RHEL75SAPHAUSHVM": "ami-0d81d8964ccf8bdef",
                "RHEL76SAPHAUSHVM": "ami-054a9dc6c144331a0",
                "SLES11SP4HVM": "ami-05b47745292b62b8e",
                "SLES12SP1HVM": "ami-1eeab909",
                "SLES12SP1SAPBYOSHVM": "ami-7dd2256b",
                "SLES12SP2HVM": "ami-8fac8399",
                "SLES12SP2SAPBYOSHVM": "ami-0f62824fdf8b862ad",
                "SLES12SP2SAPHVM": "ami-0b893cda91abd0751",
                "SLES12SP3HVM": "ami-03adb8813ffd80f0b",
                "SLES12SP3SAPBYOSHVM": "ami-0a8a9f2f6e49c913a",
                "SLES12SP3SAPHVM": "ami-0bb450ed939c9dcc6",
                "SLES12SP4HVM": "ami-043eebeabcc4e3d35",
                "SLES12SP4SAPBYOSHVM": "ami-0872ec606ae56271a",
                "SLES12SP4SAPHVM": "ami-01c1cef341b39f1b6",
                "SLES15HVM": "ami-0b1764f3d7d2e2316",
                "SLES15SAPHVM": "ami-034a4657781cac699",
                "SLES15SAPBYOSHVM": "ami-05dc98917c7287eed",
                "WS2012R2": "ami-02c1e2d2763cbee64"
            },
            "us-east-2": {
                "RHEL75SAPHVM": "ami-0b1439383ea0d0c87",
                "RHEL74SAPHAUSHVM": "ami-0cfab53d572d62388",
                "RHEL75SAPHAUSHVM": "ami-03527d73c82921684",
                "RHEL76SAPHAUSHVM": "ami-02bf9176554430b2a",
                "SLES11SP4HVM": "ami-0d984fc673fefcb8c",
                "SLES12SP1HVM": "ami-85075de0",
                "SLES12SP1SAPBYOSHVM": "ami-ac2401c9",
                "SLES12SP2HVM": "ami-f990b69c",
                "SLES12SP2SAPBYOSHVM": "ami-09766ec801f4afc73",
                "SLES12SP2SAPHVM": "ami-074016f1dd425fcc8",
                "SLES12SP3HVM": "ami-0479b39f2d07530fb",
                "SLES12SP3SAPBYOSHVM": "ami-01904d8e5200cf09a",
                "SLES12SP3SAPHVM": "ami-0cf589eb51e0dc3c3",
                "SLES12SP4HVM": "ami-00c2a324f2cf48f09",
                "SLES12SP4SAPBYOSHVM": "ami-0835dd9afdc5d1adf",
                "SLES12SP4SAPHVM": "ami-0c19dc88e07028af1",
                "SLES15HVM": "ami-05ea824317ffc0c20",
                "SLES15SAPHVM": "ami-0ad6708faee9090ba",
                "SLES15SAPBYOSHVM": "ami-0ed400a7573344904",
                "WS2012R2": "ami-00133f78ad56a5c91"
            },
            "us-west-1": {
                "RHEL75SAPHVM": "ami-015c680b92b8f8e04",
                "RHEL74SAPHAUSHVM": "ami-0bce690da8c3f9573",
                "RHEL75SAPHAUSHVM": "ami-09294cb9917bcb535",
                "RHEL76SAPHAUSHVM": "ami-05163897ae5e64145",
                "SLES11SP4HVM": "ami-07db9616cb48eef6e",
                "SLES12SP1HVM": "ami-a12962c1",
                "SLES12SP1SAPBYOSHVM": "ami-4a9dcf2a",
                "SLES12SP2HVM": "ami-32c8e552",
                "SLES12SP2SAPBYOSHVM": "ami-098c273ab19889025",
                "SLES12SP2SAPHVM": "ami-0c7907925cd713416",
                "SLES12SP3HVM": "ami-05561250b8346a707",
                "SLES12SP3SAPBYOSHVM": "ami-06376c57c523fcc9a",
                "SLES12SP3SAPHVM": "ami-084d00e0a467c9d59",
                "SLES12SP4HVM": "ami-0a33332e25e6cc1a7",
                "SLES12SP4SAPBYOSHVM": "ami-0c916e85bd909a6ec",
                "SLES12SP4SAPHVM": "ami-0472ff5210a99fab9",
                "SLES15HVM": "ami-00e34a7624e5a7107",
                "SLES15SAPHVM": "ami-0867f45fee8435a19",
                "SLES15SAPBYOSHVM": "ami-056bad2244d8748aa",
                "WS2012R2": "ami-0320422c6ac6b0f39"
            },
            "us-west-2": {
                "RHEL75SAPHVM": "ami-07894ab0a4a5e8612",
                "RHEL74SAPHAUSHVM": "ami-050890ecc1851620c",
                "RHEL75SAPHAUSHVM": "ami-07f49a6a84d94211e",
                "RHEL76SAPHAUSHVM": "ami-0062814abe5ca3369",
                "SLES11SP4HVM": "ami-09a652af9ed1e0dad",
                "SLES12SP1HVM": "ami-7fa2061f",
                "SLES12SP1SAPBYOSHVM": "ami-68922c08",
                "SLES12SP2HVM": "ami-da786da3",
                "SLES12SP2SAPBYOSHVM": "ami-0875f1dffbdffdc12",
                "SLES12SP2SAPHVM": "ami-002aa576641eeb53a",
                "SLES12SP3HVM": "ami-015ee9a0398544b09",
                "SLES12SP3SAPBYOSHVM": "ami-0ced5e921dbeadb47",
                "SLES12SP3SAPHVM": "ami-0898193014586cdd4",
                "SLES12SP4HVM": "ami-00589b0e26f1ba15b",
                "SLES12SP4SAPBYOSHVM": "ami-0e7301dd87f35c5ef",
                "SLES12SP4SAPHVM": "ami-045b62b7eebfe2d55",
                "SLES15HVM": "ami-0f1e3b3fb0fec0361",
                "SLES15SAPHVM": "ami-0ca00995da6bbdea0",
                "SLES15SAPBYOSHVM": "ami-0923cedaa89313407",
                "WS2012R2": "ami-0bfd72d59f05f83f0"
            }
        }
    },
    "Resources": {
        "AutoRecoverAlarmMaster": {
            "Type": "AWS::CloudWatch::Alarm",
            "DependsOn": "SAPPASInstance",
            "Condition": "NoUseStandardUseEFS",
            "Properties": {
                "AlarmDescription": "Trigger a recovery when instance status check fails for 2 consecutive minutes.",
                "Namespace": "AWS/EC2",
                "MetricName": "StatusCheckFailed_System",
                "Statistic": "Minimum",
                "Period": "60",
                "EvaluationPeriods": "2",
                "ComparisonOperator": "GreaterThanThreshold",
                "Threshold": "0",
                "AlarmActions": [
                    {
                        "Fn::Join": [
                            "",
                            [
                                "arn:aws:automate:",
                                {
                                    "Ref": "AWS::Region"
                                },
                                ":ec2:recover"
                            ]
                        ]
                    }
                ],
                "Dimensions": [
                    {
                        "Name": "InstanceId",
                        "Value": {
                            "Ref": "SAPPASInstance"
                        }
                    }
                ]
            }
        },
        "AutoRecoverAlarmMasterNoEFS": {
            "Type": "AWS::CloudWatch::Alarm",
            "DependsOn": "SAPPASInstanceNoEFS",
            "Condition": "NoUseStandardNoUseEFS",
            "Properties": {
                "AlarmDescription": "Trigger a recovery when instance status check fails for 2 consecutive minutes.",
                "Namespace": "AWS/EC2",
                "MetricName": "StatusCheckFailed_System",
                "Statistic": "Minimum",
                "Period": "60",
                "EvaluationPeriods": "2",
                "ComparisonOperator": "GreaterThanThreshold",
                "Threshold": "0",
                "AlarmActions": [
                    {
                        "Fn::Join": [
                            "",
                            [
                                "arn:aws:automate:",
                                {
                                    "Ref": "AWS::Region"
                                },
                                ":ec2:recover"
                            ]
                        ]
                    }
                ],
                "Dimensions": [
                    {
                        "Name": "InstanceId",
                        "Value": {
                            "Ref": "SAPPASInstanceNoEFS"
                        }
                    }
                ]
            }
        },
        "EFSFileSystem": {
            "Type": "AWS::EFS::FileSystem",
            "Condition": "NoUseStandardUseEFS",
            "Properties": {
                "PerformanceMode": "generalPurpose",
                "FileSystemTags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Ref": "SAPPASHostname"
                        }
                    }
                ]
            }
        },
        "EFSMountTarget1": {
            "Type": "AWS::EFS::MountTarget",
            "Condition": "NoUseStandardUseEFS",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystem"
                },
                "SubnetId": {
                    "Ref": "PrivateSubnetID"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SAPPASSecurityGroup"
                    }
                ]
            }
        },
        "EFSMountTarget2": {
            "Type": "AWS::EFS::MountTarget",
            "Condition": "NoUseStandardUseEFS",
            "Properties": {
                "FileSystemId": {
                    "Ref": "EFSFileSystem"
                },
                "SubnetId": {
                    "Ref": "ApplicationCIDR"
                },
                "SecurityGroups": [
                    {
                        "Ref": "SAPPASSecurityGroup"
                    }
                ]
            }
        },
        "S4HANAStack": {
            "Type": "AWS::CloudFormation::Stack",
            "Condition": "UseStandard",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}templates/sap-s4hana-standard.template"
                },
                "Parameters": {
                    "PrivSubCIDR": {
                        "Ref": "PrivateSubnet1CIDR"
                    },
                    "DMZCIDR": {
                        "Ref": "PublicSubnet1CIDR"
                    },
                    "VPCID": {
                        "Ref": "VPCID"
                    },
                    "HANASubnet": {
                        "Ref": "PrivateSubnet1AID"
                    },
                    "DMZSubnet": {
                        "Ref": "PublicSubnet1ID"
                    },
                    "DomainName": {
                        "Ref": "HostedZoneName"
                    },
                    "RemoteAccessCIDR": "0.0.0.0/0",
                    "ApplicationCIDR": "0.0.0.0/0",
                    "HANAMasterHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "HANAWorkerHostname": "imdbworker",
                    "PlacementGroupName": "",
                    "Proxy": "",
                    "KeyName": {
                        "Ref": "KeyName"
                    },
                    "MyOS": {
                        "Ref": "MyOS"
                    },
                    "MyInstanceType": {
                        "Ref": "HANAInstanceType"
                    },
                    "DedicatedHostId": "",
                    "RDPInstanceType": {
                        "Ref": "RDPInstanceType"
                    },
                    "InstallRDPInstance": "No",
                    "QSS3BucketName": {
                        "Ref": "QSS3BucketName"
                    },
                    "QSS3KeyPrefix": {
                        "Ref": "QSS3KeyPrefix"
                    },
                    "InstallHANA": {
                        "Ref": "InstallSAP"
                    },
                    "Encryption": {
                        "Ref": "Encryption"
                    },
                    "VolumeTypeHanaData": {
                        "Ref": "VolumeTypeHanaData"
                    },
                    "VolumeTypeHanaLog": {
                        "Ref": "VolumeTypeHanaLog"
                    },
                    "HostCount": {
                        "Ref": "HANAHostCount"
                    },
                    "SID": {
                        "Ref": "SID"
                    },
                    "SAPSID": {
                        "Ref": "SAPSID"
                    },
                    "SAPInstanceNum": {
                        "Ref": "SAPInstanceNum"
                    },
                    "HANAMasterPass": {
                        "Ref": "HANAMasterPass"
                    },
                    "HANAInstallMedia": {
                        "Ref": "HANAInstallMedia"
                    },
                    "SAPInstallMediaBucket": {
                        "Ref": "SAPInstallMediaBucket"
                    },
                    "SAPInstallMediaKeyPrefix": {
                        "Ref": "SAPInstallMediaKeyPrefix"
                    },
                    "AutoRecovery": "Yes",
                    "CloudTrailS3Bucket": {
                        "Ref": "CloudTrailS3Bucket"
                    },
                    "EnableLogging": {
                        "Ref": "EnableLogging"
                    },
                    "SAPTZ": {
                        "Ref": "SAPTZ"
                    },
                    "SLESBYOSRegCode": {
                        "Ref": "SLESBYOSRegCode"
                    }
                }
            }
        },
        "HANAStack": {
            "Type": "AWS::CloudFormation::Stack",
            "Condition": "NoUseStandardNoHA",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}submodules/quickstart-sap-hana/templates/SAP-HANA-BaseNodes.template"
                },
                "Parameters": {
                    "DMZCIDR": {
                        "Ref": "PublicSubnet1CIDR"
                    },
                    "DMZSubnet": {
                        "Ref": "PublicSubnet1ID"
                    },
                    "Encryption": {
                        "Ref": "Encryption"
                    },
                    "HANAInstallMedia": {
                        "Ref": "HANAInstallMedia"
                    },
                    "HANAMasterHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "HANAMasterPass": {
                        "Ref": "HANAMasterPass"
                    },
                    "HANASubnet": {
                        "Ref": "PrivateSubnet1AID"
                    },
                    "HostCount": {
                        "Ref": "HANAHostCount"
                    },
                    "InstallHANA": {
                        "Ref": "InstallSAP"
                    },
                    "InstallRDPInstance": {
                        "Ref": "InstallRDPInstance"
                    },
                    "KeyName": {
                        "Ref": "KeyName"
                    },
                    "MyOS": {
                        "Fn::FindInMap": [
                            "SAPHANAOSNameMap",
                            {
                                "Ref": "MyOSHANA"
                            },
                            "Code"
                        ]
                    },
                    "MyInstanceType": {
                        "Ref": "HANAInstanceType"
                    },
                    "ApplicationCIDR": {
                        "Ref": "PrivateSubnet2CIDR"
                    },
                    "PrivSubCIDR": {
                        "Ref": "PrivateSubnet1CIDR"
                    },
                    "RDPInstanceType": {
                        "Ref": "RDPInstanceType"
                    },
                    "SAPTZ": {
                        "Ref": "SAPTZ"
                    },
                    "SAPInstanceNum": {
                        "Ref": "SAPInstanceNum"
                    },
                    "SID": {
                        "Ref": "SID"
                    },
                    "SLESBYOSRegCode": {
                        "Ref": "SLESBYOSRegCode"
                    },
                    "VolumeTypeHanaData": {
                        "Ref": "VolumeTypeHanaData"
                    },
                    "VolumeTypeHanaLog": {
                        "Ref": "VolumeTypeHanaLog"
                    },
                    "VPCID": {
                        "Ref": "VPCID"
                    }
                }
            }
        },
        "HostedZone": {
            "Type": "AWS::Route53::HostedZone",
            "Condition": "NoUseStandardNoHA",
            "Properties": {
                "HostedZoneConfig": {
                    "Comment": "R53 private hosted zone"
                },
                "Name": {
                    "Ref": "HostedZoneName"
                },
                "VPCs": [
                    {
                        "VPCId": {
                            "Ref": "VPCID"
                        },
                        "VPCRegion": {
                            "Ref": "AWS::Region"
                        }
                    }
                ],
                "HostedZoneTags": [
                    {
                        "Key": "StackName",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    }
                ]
            }
        },
        "SAPNetWeaverPassSSMParam": {
            "Type": "AWS::SSM::Parameter",
            "Condition": "NoUseStandardNoHA",
            "Properties": {
                "Description": "Encrypted parameter store for master SAP password",
                "Type": "String",
                "Value": {
                    "Ref": "HANAMasterPass"
                }
            }
        },
        "SAPPASInterface": {
            "Type": "AWS::EC2::NetworkInterface",
            "Condition": "NoUseStandardNoHA",
            "Properties": {
                "Description": "Network Interface for SAP PAS server",
                "SubnetId": {
                    "Ref": "PrivateSubnet1AID"
                },
                "GroupSet": [
                    {
                        "Ref": "SAPPASSecurityGroup"
                    }
                ],
                "SourceDestCheck": "true",
                "Tags": [
                    {
                        "Key": "Network",
                        "Value": "Private"
                    }
                ]
            }
        },
        "SAPPASSecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Condition": "NoUseStandardNoHA",
            "Properties": {
                "GroupDescription": "Enable access to the SAP Servers",
                "VpcId": {
                    "Ref": "VPCID"
                },
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "udp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet1CIDR"
                        },
                        "FromPort": "111",
                        "ToPort": "111"
                    },
                    {
                        "IpProtocol": "udp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet1CIDR"
                        },
                        "FromPort": "2049",
                        "ToPort": "2049"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet1CIDR"
                        },
                        "FromPort": "2049",
                        "ToPort": "2049"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet1CIDR"
                        },
                        "FromPort": "20048",
                        "ToPort": "20048"
                    },
                    {
                        "IpProtocol": "udp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet1CIDR"
                        },
                        "FromPort": "20048",
                        "ToPort": "20048"
                    },
                    {
                        "IpProtocol": "icmp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet1CIDR"
                        },
                        "FromPort": "-1",
                        "ToPort": "-1"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet1CIDR"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "32",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "33",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet1CIDR"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "36",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "36",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet1CIDR"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "39",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "39",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet1CIDR"
                        },
                        "FromPort": "1128",
                        "ToPort": "1128"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet1CIDR"
                        },
                        "FromPort": "1129",
                        "ToPort": "1129"
                    },
                    {
                        "IpProtocol": "udp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet2CIDR"
                        },
                        "FromPort": "111",
                        "ToPort": "111"
                    },
                    {
                        "IpProtocol": "udp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet2CIDR"
                        },
                        "FromPort": "2049",
                        "ToPort": "2049"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet2CIDR"
                        },
                        "FromPort": "2049",
                        "ToPort": "2049"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet2CIDR"
                        },
                        "FromPort": "20048",
                        "ToPort": "20048"
                    },
                    {
                        "IpProtocol": "udp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet2CIDR"
                        },
                        "FromPort": "20048",
                        "ToPort": "20048"
                    },
                    {
                        "IpProtocol": "icmp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet2CIDR"
                        },
                        "FromPort": "-1",
                        "ToPort": "-1"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet2CIDR"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "32",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "33",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet2CIDR"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "36",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "36",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet2CIDR"
                        },
                        "FromPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "39",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        },
                        "ToPort": {
                            "Fn::Join": [
                                "",
                                [
                                    "39",
                                    {
                                        "Ref": "SAPInstanceNum"
                                    },
                                    ""
                                ]
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet2CIDR"
                        },
                        "FromPort": "1128",
                        "ToPort": "1128"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet2CIDR"
                        },
                        "FromPort": "1129",
                        "ToPort": "1129"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet1CIDR"
                        },
                        "FromPort": "22",
                        "ToPort": "22"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PrivateSubnet2CIDR"
                        },
                        "FromPort": "22",
                        "ToPort": "22"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PublicSubnet1CIDR"
                        },
                        "FromPort": "22",
                        "ToPort": "22"
                    },
                    {
                        "IpProtocol": "tcp",
                        "CidrIp": {
                            "Ref": "PublicSubnet2CIDR"
                        },
                        "FromPort": "22",
                        "ToPort": "22"
                    }
                ],
                "SecurityGroupEgress": [
                    {
                        "IpProtocol": "-1",
                        "CidrIp": "0.0.0.0/0",
                        "FromPort": "1",
                        "ToPort": "65535"
                    }
                ]
            }
        },
        "SAPPASIAMRole": {
            "Type": "AWS::IAM::Role",
            "Condition": "NoUseStandardNoHA",
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "ec2.amazonaws.com",
                                    "ssm.amazonaws.com"
                                ]
                            },
                            "Action": [
                                "sts:AssumeRole"
                            ]
                        }
                    ]
                },
                "Path": "/",
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/service-role/AmazonEC2RoleforSSM"
                ],
                "Policies": [
                    {
                        "PolicyName": "SAP-PAS-Role",
                        "PolicyDocument": {
                            "Statement": [
                                {
                                    "Effect": "Allow",
                                    "Action": "cloudwatch:GetMetricStatistics",
                                    "Resource": "*"
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "s3:GetObject"
                                    ],
                                    "Resource": [
                                        {
                                            "Fn::Sub": "arn:aws:s3:::${QSS3BucketName}/${QSS3KeyPrefix}*"
                                        },
                                        {
                                            "Fn::Sub": "arn:aws:s3:::aws-data-provider/*"
                                        },
                                        {
                                            "Fn::Sub": "arn:aws:s3:::${SAPInstallMediaBucket}/${SAPInstallMediaKeyPrefix}*"
                                        }
                                    ]
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "s3:ListBucket"
                                    ],
                                    "Resource": [
                                        {
                                            "Fn::Sub": "arn:aws:s3:::${SAPInstallMediaBucket}"
                                        }
                                    ]
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "ec2:DescribeInstances",
                                        "ec2:DescribeVolumes"
                                    ],
                                    "Resource": "*"
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": [
                                        "ec2messages:*"
                                    ],
                                    "Resource": "*"
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": "ssm:*",
                                    "Resource": {
                                        "Fn::Sub": "arn:aws:ssm:${AWS::Region}:${AWS::AccountId}:parameter/${SAPNetWeaverPassSSMParam}"
                                    }
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": "ssm:ListCommandInvocations",
                                    "Resource": {
                                        "Fn::Sub": "arn:aws:ssm:${AWS::Region}:${AWS::AccountId}:*"
                                    }
                                },
                                {
                                    "Effect": "Allow",
                                    "Action": "ssm:*",
                                    "Resource": [
                                        {
                                            "Fn::Sub": "arn:aws:ec2:${AWS::Region}:${AWS::AccountId}:instance/*"
                                        },
                                        {
                                            "Fn::Sub": "arn:aws:ssm:${AWS::Region}:${AWS::AccountId}:instance/*"
                                        },
                                        {
                                            "Fn::Sub": "arn:aws:ssm:${AWS::Region}::document/AWS-RunShellScript"
                                        }
                                    ]
                                }
                            ]
                        }
                    }
                ]
            }
        },
        "SAPIAMProfile": {
            "Type": "AWS::IAM::InstanceProfile",
            "Condition": "NoUseStandardNoHA",
            "Properties": {
                "Path": "/",
                "Roles": [
                    {
                        "Ref": "SAPPASIAMRole"
                    }
                ]
            }
        },
        "SAPHANAR53Record": {
            "Type": "AWS::Route53::RecordSet",
            "Condition": "NoUseStandardNoHA",
            "DependsOn": "HANAStack",
            "Properties": {
                "HostedZoneId": {
                    "Ref": "HostedZone"
                },
                "Name": {
                    "Fn::Sub": "${SAPHANAHostname}.${HostedZoneName}"
                },
                "Type": "A",
                "TTL": "30",
                "ResourceRecords": [
                    {
                        "Fn::GetAtt": [
                            "HANAStack",
                            "Outputs.HANAMasterInstanceIP"
                        ]
                    }
                ]
            }
        },
        "SAPPASR53Record": {
            "Type": "AWS::Route53::RecordSet",
            "Condition": "NoUseStandardNoHA",
            "DependsOn": "SAPPASInterface",
            "Properties": {
                "HostedZoneId": {
                    "Ref": "HostedZone"
                },
                "Name": {
                    "Fn::Sub": "${SAPPASHostname}.${HostedZoneName}"
                },
                "Type": "A",
                "TTL": "30",
                "ResourceRecords": [
                    {
                        "Fn::GetAtt": [
                            "SAPPASInterface",
                            "PrimaryPrivateIpAddress"
                        ]
                    }
                ]
            }
        },
        "WaitForSAPInstall": {
            "Type": "AWS::CloudFormation::WaitCondition",
            "Condition": "NoUseStandardNoHA",
            "Properties": {
                "Handle": {
                    "Ref": "WaitForSAPInstallWaitHandle"
                },
                "Timeout": "14400"
            }
        },
        "WaitForSAPInstallWaitHandle": {
            "Type": "AWS::CloudFormation::WaitConditionHandle",
            "Condition": "NoUseStandardNoHA",
            "Properties": {}
        },
        "SAPPASInstance": {
            "Condition": "NoUseStandardUseEFS",
            "DependsOn": "HANAStack",
            "Type": "AWS::EC2::Instance",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "type": "S3",
                        "roleName": {
                            "Ref": "SAPPASIAMRole"
                        },
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ]
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "files": {
                            "/root/install/config.sh": {
                                "content": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export EFS=",
                                            {
                                                "Ref": "EFSSapmnt"
                                            },
                                            "\n",
                                            "export EFS_MT=",
                                            {
                                                "Ref": "EFSFileSystem"
                                            },
                                            "\n",
                                            "export HOSTED_ZONE=",
                                            {
                                                "Ref": "HostedZoneName"
                                            },
                                            "\n",
                                            "export INSTALL_SAP=",
                                            {
                                                "Ref": "InstallSAP"
                                            },
                                            "\n",
                                            "export INSTALL_SAP_VERSION=",
                                            {
                                                "Ref": "InstallSAPVersion"
                                            },
                                            "\n",
                                            "export S3_BUCKET=",
                                            {
                                                "Ref": "SAPInstallMediaBucket"
                                            },
                                            "\n",
                                            "export S3_BUCKET_KP=",
                                            {
                                                "Ref": "SAPInstallMediaKeyPrefix"
                                            },
                                            "\n",
                                            "export SAP_SCHEMA_NAME=",
                                            {
                                                "Ref": "SAPSchemaName"
                                            },
                                            "\n",
                                            "export SAP_SID=",
                                            {
                                                "Ref": "SID"
                                            },
                                            "\n",
                                            "export SSM_PARAM_STORE=",
                                            {
                                                "Ref": "SAPNetWeaverPassSSMParam"
                                            },
                                            "\n",
                                            "export TZ_INPUT_PARAM=",
                                            {
                                                "Ref": "SAPTZ"
                                            },
                                            "\n",
                                            "export DBHOSTNAME=",
                                            {
                                                "Ref": "SAPHANAHostname"
                                            },
                                            "\n",
                                            "export SAPPAS_HOSTNAME=",
                                            {
                                                "Ref": "SAPPASHostname"
                                            },
                                            "\n",
                                            "export DBIP=",
                                            {
                                                "Fn::GetAtt": [
                                                    "HANAStack",
                                                    "Outputs.HANAMasterInstanceIP"
                                                ]
                                            },
                                            "\n",
                                            "export MyOS=",
                                            {
                                                "Ref": "MyOS"
                                            },
                                            "\n",
                                            "export SLESBYOSRegCode=",
                                            {
                                                "Ref": "SLESBYOSRegCode"
                                            },
                                            "\n",
                                            "export SAPInstanceNum=",
                                            {
                                                "Ref": "SAPInstanceNum"
                                            },
                                            "\n",
                                            "export WaitForSAPInstallWaitHandle=",
                                            "\"",
                                            {
                                                "Ref": "WaitForSAPInstallWaitHandle"
                                            },
                                            "\"",
                                            "\n",
                                            "export SIDadmUID=",
                                            {
                                                "Ref": "SIDadmUID"
                                            },
                                            "\n",
                                            "export REGION=",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\n"
                                        ]
                                    ]
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root"
                            },
                            "/root/install/s4-aas.params": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/s4-aas.params"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            },
                            "/root/install/s4-ascs.params": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/s4-ascs.params"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            },
                            "/root/install/s4-db.params": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/s4-db.params"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            },
                            "/root/install/s4-pas.params": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/s4-pas.params"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            },
                            "/root/install/download-sapapp.sh": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/download-sapapp.sh"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            },
                            "/root/install/signalFinalStatus.sh": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/signalFinalStatus.sh"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            },
                            "/root/install/sap-s4hana-pas-inst-single-host.sh": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/sap-s4hana-pas-inst-single-host.sh"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            }
                        },
                        "commands": {
                            "startinstall": {
                                "command": "bash -xv /root/install/download-sapapp.sh"
                            }
                        }
                    }
                }
            },
            "Properties": {
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sda1",
                        "Ebs": {
                            "DeleteOnTermination": "True",
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    },
                    {
                        "DeviceName": "/dev/xvdb",
                        "Ebs": {
                            "DeleteOnTermination": "True",
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    },
                    {
                        "DeviceName": "/dev/xvdc",
                        "Ebs": {
                            "DeleteOnTermination": "True",
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    },
                    {
                        "DeviceName": "/dev/xvdd",
                        "Ebs": {
                            "DeleteOnTermination": "True",
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "SAPIAMProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegionMap",
                        {
                            "Ref": "AWS::Region"
                        },
                        {
                            "Fn::FindInMap": [
                                "SAPAMINameMap",
                                {
                                    "Ref": "MyOS"
                                },
                                "Code"
                            ]
                        }
                    ]
                },
                "InstanceType": {
                    "Ref": "MyInstanceType"
                },
                "KeyName": {
                    "Ref": "KeyName"
                },
                "NetworkInterfaces": [
                    {
                        "NetworkInterfaceId": {
                            "Ref": "SAPPASInterface"
                        },
                        "DeviceIndex": "0"
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Ref": "SAPPASHostname"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash\n",
                                "export PATH=$PATH:/usr/local/bin\n",
                                "mkdir -p /root/install\n",
                                "hostname ",
                                {
                                    "Ref": "SAPPASHostname"
                                },
                                "\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        ".",
                                        [
                                            {
                                                "Ref": "SAPPASHostname"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/HOSTNAME\n",
                                "       cd /tmp\n",
                                "       wget https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz\n",
                                "       gzip -df aws-cfn-bootstrap-latest.tar.gz\n",
                                "       tar -xvf aws-cfn-bootstrap-latest.tar\n",
                                "       #ln -s /tmp/aws-cfn-bootstrap-1.4 /opt/aws\n",
                                "       chmod -R 755 /tmp/aws-cfn-bootstrap-1.4\n",
                                "       # Temp AMI accessing SuSE repo fix for SLES12SP3forSAP and SLES15forSAP\n",
                                "       if grep -i suse /etc/os-release\n",
                                "       then\n",
                                "           if ls -l /etc/products.d/baseproduct | grep -v \"SLES_SAP.prod\"\n",
                                "           then\n",
                                "               cd /etc/products.d\n" ,
                                "               unlink baseproduct\n",
                                "               ln -s SLES_SAP.prod baseproduct\n",
                                "               registercloudguest --force-new\n",
                                "           fi\n",
                                "       fi\n",
                                "       which pip &> /dev/null\n",
                                "       if [ $? -ne 0 ] ;then\n",
                                "           echo \"PIP NOT INSTALLED\"\n",
                                "           curl -O https://bootstrap.pypa.io/get-pip.py\n",
                                "           python get-pip.py\n",
                                "       #    [ `which yum` ] && $(yum install -y epel-release; yum install -y python-pip) && echo \"PIP INSTALLED\"\n",
                                "       #    [ `which apt-get` ] && apt-get -y update && apt-get -y install python-pip && echo \"PIP INSTALLED\"\n",
                                "       #    [ `which zypper` ] && zypper -n install python-pip && echo \"PIP INSTALLED\"\n",
                                "       fi\n",
                                "       pip install --upgrade pip\n",
                                "       pip install --upgrade setuptools\n",
                                "       pip install awscli --ignore-installed six &> /dev/null\n",
                                "       export PYTHONPATH=/tmp/aws-cfn-bootstrap-1.4:$PYTHONPATH\n",
                                "       /tmp/aws-cfn-bootstrap-1.4/bin/cfn-init -v ",
                                "         --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "         --resource SAPPASInstance ",
                                "         --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n"
                            ]
                        ]
                    }
                }
            }
        },
        "SAPPASInstanceNoEFS": {
            "Condition": "NoUseStandardNoUseEFS",
            "DependsOn": "HANAStack",
            "Type": "AWS::EC2::Instance",
            "Metadata": {
                "AWS::CloudFormation::Authentication": {
                    "S3AccessCreds": {
                        "type": "S3",
                        "roleName": {
                            "Ref": "SAPPASIAMRole"
                        },
                        "buckets": [
                            {
                                "Ref": "QSS3BucketName"
                            }
                        ]
                    }
                },
                "AWS::CloudFormation::Init": {
                    "config": {
                        "files": {
                            "/root/install/config.sh": {
                                "content": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "export EFS=",
                                            {
                                                "Ref": "EFSSapmnt"
                                            },
                                            "\n",
                                            "export HOSTED_ZONE=",
                                            {
                                                "Ref": "HostedZoneName"
                                            },
                                            "\n",
                                            "export INSTALL_SAP=",
                                            {
                                                "Ref": "InstallSAP"
                                            },
                                            "\n",
                                            "export INSTALL_SAP_VERSION=",
                                            {
                                                "Ref": "InstallSAPVersion"
                                            },
                                            "\n",
                                            "export S3_BUCKET=",
                                            {
                                                "Ref": "SAPInstallMediaBucket"
                                            },
                                            "\n",
                                            "export S3_BUCKET_KP=",
                                            {
                                                "Ref": "SAPInstallMediaKeyPrefix"
                                            },
                                            "\n",
                                            "export SAP_SCHEMA_NAME=",
                                            {
                                                "Ref": "SAPSchemaName"
                                            },
                                            "\n",
                                            "export SAP_SID=",
                                            {
                                                "Ref": "SID"
                                            },
                                            "\n",
                                            "export SSM_PARAM_STORE=",
                                            {
                                                "Ref": "SAPNetWeaverPassSSMParam"
                                            },
                                            "\n",
                                            "export TZ_INPUT_PARAM=",
                                            {
                                                "Ref": "SAPTZ"
                                            },
                                            "\n",
                                            "export DBHOSTNAME=",
                                            {
                                                "Ref": "SAPHANAHostname"
                                            },
                                            "\n",
                                            "export SAPPAS_HOSTNAME=",
                                            {
                                                "Ref": "SAPPASHostname"
                                            },
                                            "\n",
                                            "export DBIP=",
                                            {
                                                "Fn::GetAtt": [
                                                    "HANAStack",
                                                    "Outputs.HANAMasterInstanceIP"
                                                ]
                                            },
                                            "\n",
                                            "export MyOS=",
                                            {
                                                "Ref": "MyOS"
                                            },
                                            "\n",
                                            "export SLESBYOSRegCode=",
                                            {
                                                "Ref": "SLESBYOSRegCode"
                                            },
                                            "\n",
                                            "export SAPInstanceNum=",
                                            {
                                                "Ref": "SAPInstanceNum"
                                            },
                                            "\n",
                                            "export WaitForSAPInstallWaitHandle=",
                                            "\"",
                                            {
                                                "Ref": "WaitForSAPInstallWaitHandle"
                                            },
                                            "\"",
                                            "\n",
                                            "export SIDadmUID=",
                                            {
                                                "Ref": "SIDadmUID"
                                            },
                                            "\n",
                                            "export REGION=",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\n"
                                        ]
                                    ]
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root"
                            },
                            "/root/install/s4-aas.params": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/s4-aas.params"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            },
                            "/root/install/s4-ascs.params": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/s4-ascs.params"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            },
                            "/root/install/s4-db.params": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/s4-db.params"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            },
                            "/root/install/s4-pas.params": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/s4-pas.params"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            },
                            "/root/install/download-sapapp.sh": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/download-sapapp.sh"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            },
                            "/root/install/signalFinalStatus.sh": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/signalFinalStatus.sh"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            },
                            "/root/install/sap-s4hana-pas-inst-single-host.sh": {
                                "source": {
                                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}scripts/sap-s4hana-pas-inst-single-host.sh"
                                },
                                "mode": "000500",
                                "owner": "root",
                                "group": "root",
                                "authentication": "S3AccessCreds"
                            }
                        },
                        "commands": {
                            "startinstall": {
                                "command": "bash -xv /root/install/download-sapapp.sh"
                            }
                        }
                    }
                }
            },
            "Properties": {
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sda1",
                        "Ebs": {
                            "DeleteOnTermination": "True",
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    },
                    {
                        "DeviceName": "/dev/xvdb",
                        "Ebs": {
                            "DeleteOnTermination": "True",
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    },
                    {
                        "DeviceName": "/dev/xvdc",
                        "Ebs": {
                            "DeleteOnTermination": "True",
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    },
                    {
                        "DeviceName": "/dev/xvdd",
                        "Ebs": {
                            "DeleteOnTermination": "True",
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "SAPIAMProfile"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "AWSAMIRegionMap",
                        {
                            "Ref": "AWS::Region"
                        },
                        {
                            "Fn::FindInMap": [
                                "SAPAMINameMap",
                                {
                                    "Ref": "MyOS"
                                },
                                "Code"
                            ]
                        }
                    ]
                },
                "InstanceType": {
                    "Ref": "MyInstanceType"
                },
                "KeyName": {
                    "Ref": "KeyName"
                },
                "NetworkInterfaces": [
                    {
                        "NetworkInterfaceId": {
                            "Ref": "SAPPASInterface"
                        },
                        "DeviceIndex": "0"
                    }
                ],
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "SAP PAS Server-Quick Start"
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash\n",
                                "export PATH=$PATH:/usr/local/bin\n",
                                "mkdir -p /root/install\n",
                                "hostname ",
                                {
                                    "Ref": "SAPPASHostname"
                                },
                                "\n",
                                "echo ",
                                {
                                    "Fn::Join": [
                                        ".",
                                        [
                                            {
                                                "Ref": "SAPPASHostname"
                                            }
                                        ]
                                    ]
                                },
                                " > /etc/HOSTNAME\n",
                                "       cd /tmp\n",
                                "       wget https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz\n",
                                "       gzip -df aws-cfn-bootstrap-latest.tar.gz\n",
                                "       tar -xvf aws-cfn-bootstrap-latest.tar\n",
                                "       #ln -s /tmp/aws-cfn-bootstrap-1.4 /opt/aws\n",
                                "       chmod -R 755 /tmp/aws-cfn-bootstrap-1.4\n",
                                "       # Temp AMI accessing SuSE repo fix for SLES12SP3forSAP and SLES15forSAP\n",
                                "       if grep -i suse /etc/os-release\n",
                                "       then\n",
                                "           if ls -l /etc/products.d/baseproduct | grep -v \"SLES_SAP.prod\"\n",
                                "           then\n",
                                "               cd /etc/products.d\n" ,
                                "               unlink baseproduct\n",
                                "               ln -s SLES_SAP.prod baseproduct\n",
                                "               registercloudguest --force-new\n",
                                "           fi\n",
                                "       fi\n",
                                "       which pip &> /dev/null\n",
                                "       if [ $? -ne 0 ] ;then\n",
                                "           echo \"PIP NOT INSTALLED\"\n",
                                "           curl -O https://bootstrap.pypa.io/get-pip.py\n",
                                "           python get-pip.py\n",
                                "       #    [ `which yum` ] && $(yum install -y epel-release; yum install -y python-pip) && echo \"PIP INSTALLED\"\n",
                                "       #    [ `which apt-get` ] && apt-get -y update && apt-get -y install python-pip && echo \"PIP INSTALLED\"\n",
                                "       #    [ `which zypper` ] && zypper -n install python-pip && echo \"PIP INSTALLED\"\n",
                                "       fi\n",
                                "       pip install --upgrade pip\n",
                                "       pip install --upgrade setuptools\n",
                                "       pip install awscli --ignore-installed six &> /dev/null\n",
                                "       export PYTHONPATH=/tmp/aws-cfn-bootstrap-1.4:$PYTHONPATH\n",
                                "       /tmp/aws-cfn-bootstrap-1.4/bin/cfn-init -v ",
                                "         --stack ",
                                {
                                    "Ref": "AWS::StackName"
                                },
                                "         --resource SAPPASInstanceNoEFS ",
                                "         --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n"
                            ]
                        ]
                    }
                }
            }
        },
        "SAPAASStack": {
            "Condition": "NoUseStandardUseEFSAAS",
            "DependsOn": "WaitForSAPInstall",
            "Type": "AWS::CloudFormation::Stack",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}templates/sap-s4hana-aas.template"
                },
                "Parameters": {
                    "AutoRecovery": {
                        "Ref": "AutoRecoveryAAS"
                    },
                    "EFSSapmnt": {
                        "Ref": "EFSSapmnt"
                    },
                    "EFSFSName": {
                        "Ref": "EFSFileSystem"
                    },
                    "HostedZoneID": {
                        "Ref": "HostedZone"
                    },
                    "HostedZoneName": {
                        "Ref": "HostedZoneName"
                    },
                    "InstallSAP": {
                        "Ref": "InstallSAP"
                    },
                    "InstallSAPVersion": {
                        "Ref": "InstallSAPVersion"
                    },
                    "KeyName": {
                        "Ref": "KeyName"
                    },
                    "MyInstanceType": {
                        "Ref": "AASMyInstanceType"
                    },
                    "MyOS": {
                        "Ref": "MyOS"
                    },
                    "PrivateSubnet1CIDR": {
                        "Ref": "PrivateSubnet1CIDR"
                    },
                    "PrivateSubnetID": {
                        "Ref": "PrivateSubnetID"
                    },
                    "PrivateSubnet2CIDR": {
                        "Ref": "PrivateSubnet2CIDR"
                    },
                    "PublicSubnet1CIDR": {
                        "Ref": "PublicSubnet1CIDR"
                    },
                    "PublicSubnet2CIDR": {
                        "Ref": "PublicSubnet2CIDR"
                    },
                    "QSS3BucketName": {
                        "Ref": "QSS3BucketName"
                    },
                    "QSS3KeyPrefix": {
                        "Ref": "QSS3KeyPrefix"
                    },
                    "SAPAASHostname": {
                        "Ref": "SAPAASHostname"
                    },
                    "SAPHANAHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "SAPInstanceNum": {
                        "Ref": "SAPInstanceNum"
                    },
                    "SAPNetWeaverPassSSMParamName": {
                        "Ref": "SAPNetWeaverPassSSMParam"
                    },
                    "SAPPASHostname": {
                        "Ref": "SAPPASHostname"
                    },
                    "SAPSchemaName": {
                        "Ref": "SAPSchemaName"
                    },
                    "SAPTZ": {
                        "Ref": "SAPTZ"
                    },
                    "SID": {
                        "Ref": "SID"
                    },
                    "SIDadmUID": {
                        "Ref": "SIDadmUID"
                    },
                    "SLESBYOSRegCode": {
                        "Ref": "SLESBYOSRegCode"
                    },
                    "VPCID": {
                        "Ref": "VPCID"
                    }
                }
            }
        },
        "SAPAASStackNoEFS": {
            "Condition": "NoUseStandardNoUseEFSAAS",
            "DependsOn": "WaitForSAPInstall",
            "Type": "AWS::CloudFormation::Stack",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}templates/sap-s4hana-aas.template"
                },
                "Parameters": {
                    "AutoRecovery": {
                        "Ref": "AutoRecoveryAAS"
                    },
                    "HostedZoneID": {
                        "Ref": "HostedZone"
                    },
                    "HostedZoneName": {
                        "Ref": "HostedZoneName"
                    },
                    "InstallSAP": {
                        "Ref": "InstallSAP"
                    },
                    "InstallSAPVersion": {
                        "Ref": "InstallSAPVersion"
                    },
                    "KeyName": {
                        "Ref": "KeyName"
                    },
                    "MyInstanceType": {
                        "Ref": "AASMyInstanceType"
                    },
                    "MyOS": {
                        "Ref": "MyOS"
                    },
                    "PrivateSubnet1CIDR": {
                        "Ref": "PrivateSubnet1CIDR"
                    },
                    "PrivateSubnetID": {
                        "Ref": "PrivateSubnetID"
                    },
                    "PrivateSubnet2CIDR": {
                        "Ref": "PrivateSubnet2CIDR"
                    },
                    "PublicSubnet1CIDR": {
                        "Ref": "PublicSubnet1CIDR"
                    },
                    "PublicSubnet2CIDR": {
                        "Ref": "PublicSubnet2CIDR"
                    },
                    "QSS3BucketName": {
                        "Ref": "QSS3BucketName"
                    },
                    "QSS3KeyPrefix": {
                        "Ref": "QSS3KeyPrefix"
                    },
                    "SAPAASHostname": {
                        "Ref": "SAPAASHostname"
                    },
                    "SAPHANAHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "SAPInstanceNum": {
                        "Ref": "SAPInstanceNum"
                    },
                    "SAPNetWeaverPassSSMParamName": {
                        "Ref": "SAPNetWeaverPassSSMParam"
                    },
                    "SAPPASHostname": {
                        "Ref": "SAPPASHostname"
                    },
                    "SAPSchemaName": {
                        "Ref": "SAPSchemaName"
                    },
                    "SAPTZ": {
                        "Ref": "SAPTZ"
                    },
                    "SID": {
                        "Ref": "SID"
                    },
                    "SIDadmUID": {
                        "Ref": "SIDadmUID"
                    },
                    "SLESBYOSRegCode": {
                        "Ref": "SLESBYOSRegCode"
                    },
                    "VPCID": {
                        "Ref": "VPCID"
                    }
                }
            }
        },
        "S4ExgVPCHA": {
            "Type": "AWS::CloudFormation::Stack",
            "Condition": "UseHA",
            "Properties": {
                "TemplateURL": {
                    "Fn::Sub": "https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}templates/sap-s4hana-exg-vpc-HA.template"
                },
                "Parameters": {
                    "AutoRecoveryAAS": {
                        "Ref": "AutoRecoveryAAS"
                    },
                    "AutoRecoveryPAS": {
                        "Ref": "AutoRecoveryPAS"
                    },
                    "AASMyInstanceType": {
                        "Ref": "AASMyInstanceType"
                    },
                    "CloudTrailS3Bucket": {
                        "Ref": "CloudTrailS3Bucket"
                    },
                    "EFSSapmnt": {
                        "Ref": "EFSSapmnt"
                    },
                    "EnableLogging": {
                        "Ref": "EnableLogging"
                    },
                    "Encryption": {
                        "Ref": "Encryption"
                    },
                    "HANAHostCount": {
                        "Ref": "HANAHostCount"
                    },
                    "HANAInstallMedia": {
                        "Ref": "HANAInstallMedia"
                    },
                    "HANAInstanceType": {
                        "Ref": "HANAInstanceType"
                    },
                    "HANAMasterPass": {
                        "Ref": "HANAMasterPass"
                    },
                    "HostedZoneName": {
                        "Ref": "HostedZoneName"
                    },
                    "InstallRDPInstance": {
                        "Ref": "InstallRDPInstance"
                    },
                    "InstallSAPAAS": {
                        "Ref": "InstallSAPAAS"
                    },
                    "InstallSAP": {
                        "Ref": "InstallSAP"
                    },
                    "InstallSAPVersion": {
                        "Ref": "InstallSAPVersion"
                    },
                    "KeyName": {
                        "Ref": "KeyName"
                    },
                    "MyInstanceType": {
                        "Ref": "MyInstanceType"
                    },
                    "MyOS": {
                        "Ref": "MyOS"
                    },
                    "MyOSHANA": {
                        "Ref": "MyOSHANA"
                    },
                    "ApplicationCIDR": {
                        "Ref": "ApplicationCIDR"
                    },
                    "PrivateSubnetID": {
                        "Ref": "PrivateSubnetID"
                    },
                    "PrivateSubnet1CIDR": {
                        "Ref": "PrivateSubnet1CIDR"
                    },
                    "PrivateSubnet2CIDR": {
                        "Ref": "PrivateSubnet2CIDR"
                    },
                    "PrivateSubnet1AID": {
                        "Ref": "PrivateSubnet1AID"
                    },
                    "PublicSubnet1CIDR": {
                        "Ref": "PublicSubnet1CIDR"
                    },
                    "PublicSubnet2CIDR": {
                        "Ref": "PublicSubnet2CIDR"
                    },
                    "PublicSubnet1ID": {
                        "Ref": "PublicSubnet1ID"
                    },
                    "QSS3BucketName": {
                        "Ref": "QSS3BucketName"
                    },
                    "QSS3KeyPrefix": {
                        "Ref": "QSS3KeyPrefix"
                    },
                    "RDPInstanceType": {
                        "Ref": "RDPInstanceType"
                    },
                    "SAPAASHostname": {
                        "Ref": "SAPAASHostname"
                    },
                    "SAPHANAHostname": {
                        "Ref": "SAPHANAHostname"
                    },
                    "HANAHostnameSecondary": {
                        "Ref": "HANAHostnameSecondary"
                    },
                    "SAPInstallMediaBucket": {
                        "Ref": "SAPInstallMediaBucket"
                    },
                    "SAPInstallMediaKeyPrefix": {
                        "Ref": "SAPInstallMediaKeyPrefix"
                    },
                    "SAPPASHostname": {
                        "Ref": "SAPPASHostname"
                    },
                    "SAPInstanceNum": {
                        "Ref": "SAPInstanceNum"
                    },
                    "SAPTZ": {
                        "Ref": "SAPTZ"
                    },
                    "SAPSchemaName": {
                        "Ref": "SAPSchemaName"
                    },
                    "SID": {
                        "Ref": "SID"
                    },
                    "SAPSID": {
                        "Ref": "SAPSID"
                    },
                    "SIDadmUID": {
                        "Ref": "SIDadmUID"
                    },
                    "StandardInstall": {
                        "Ref": "StandardInstall"
                    },
                    "SLESBYOSRegCode": {
                        "Ref": "SLESBYOSRegCode"
                    },
                    "VolumeTypeHanaData": {
                        "Ref": "VolumeTypeHanaData"
                    },
                    "VolumeTypeHanaLog": {
                        "Ref": "VolumeTypeHanaLog"
                    },
                    "VPCID": {
                        "Ref": "VPCID"
                    }
                }
            }
        }
    },
    "Rules": {
        "EFSSupport": {
            "RuleCondition": {
                "Fn::Equals": [
                    {
                        "Ref": "EFSSapmnt"
                    },
                    "Yes"
                ]
            },
            "Assertions": [
                {
                    "Assert": {
                        "Fn::Contains": [
                            [
                                "us-east-1",
                                "us-east-2",
                                "us-west-1",
                                "us-west-2",
                                "eu-central-1",
                                "eu-west-1",
                                "eu-west-2",
                                "eu-west-3", 
                                "eu-central-1",
                                "ca-central-1",
                                "ap-south-1",
                                "ap-northeast-1",
                                "ap-northeast-2",
                                "ap-southeast-1",
                                "ap-southeast-2"
                            ],
                            {
                                "Ref": "AWS::Region"
                            }
                        ]
                    },
                    "AssertDescription": "!!ALERT: This is *not* an AWS Region that supports EFS!!"
                }
            ]
        }
    },
    "Outputs": {
        "EFSFSName": {
            "Description": "EFS file system name",
            "Condition": "UseEFSNoHA",
            "Value": {
                "Ref": "EFSFileSystem"
            }
        },
        "EFSSapmnt": {
            "Description": "Use EFS for /sapmnt",
            "Condition": "NoUseStandardNoHA",
            "Value": {
                "Ref": "EFSSapmnt"
            }
        },
        "SAPNetWeaverPassSSMParam": {
            "Description": "EC2 SSM parameter store for encrypted SAP master password",
            "Condition": "NoUseStandardNoHA",
            "Value": {
                "Ref": "SAPNetWeaverPassSSMParam"
            }
        },
        "SIDadmUID": {
            "Description": "SIDadm UID",
            "Value": {
                "Ref": "SIDadmUID"
            }
        },
        "SAPPASSecurityGroup": {
            "Description": "Security Group created for the SAP PAS Server",
            "Condition": "NoUseStandardNoHA",
            "Value": {
                "Fn::GetAtt": [
                    "SAPPASSecurityGroup",
                    "GroupId"
                ]
            }
        }
    }
}